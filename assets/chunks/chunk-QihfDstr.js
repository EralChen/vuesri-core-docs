import{p as V,a as O,u as b}from"./chunk-KpKdxowh.js";import{gS as S,np as T,gY as g,hd as k,lB as H,ak as B,hb as L,dg as R,gT as j,ly as h,lD as C,h7 as _,g$ as F,h8 as U,h5 as v,oB as W,ha as q}from"./chunk-Id6bT2Sz.js";import{V as x,b as w,a as E,c as A}from"./chunk-YYgKY7N-.js";import{u as D}from"./chunk-Hg0ijuo1.js";import{_ as N,c as Y}from"./chunk-SV1sIRwr.js";function z(){const a=S("vaMediaLayer");if(!a)throw new Error("The component which use useMediaLayer() must be in a MediaLayer component");return a}const G={...V,defaultOptions:{type:Object,default:()=>({})},source:{type:Object,required:!0,default:()=>({})}},M={load:a=>a,click:a=>a,pointerMove:a=>a},ae=T(M),y="__va_media_layer_retries",I=g({__name:"media-try",setup(a){const s=z(),o=s.source,c=k(),i=[],n=new Map;H(()=>{i.forEach(e=>{e.remove()})}),i.push(s.on("layerview-create",e=>{c.value=e.layerView}));const f=e=>{c.value&&R(()=>!c.value?.updating).then(e)};o instanceof x&&(d(o.elements),o.elements.on("change",()=>{setTimeout(()=>{d(o.elements)},600)}));function d(e){for(const t of n.values())t.remove();n.clear(),e.filter(t=>t.loadStatus!=="loaded").forEach(t=>{const r=B(()=>t.loadStatus,u=>{if(u!=="failed"){r.remove(),n.delete(t);return}f(()=>{const l=e.find(p=>p===t);if(l&&(l[y]??0)<3){e.remove(l);const p=$(l,{[y]:(l[y]??0)+1});e.add(p)}})},{once:!0});n.set(t,r)})}function $(e,t={}){let r=e;e instanceof w?r=new w({image:e.image,georeference:e.georeference,animationOptions:e.animationOptions,opacity:e.opacity}):e instanceof E&&(r=new E({video:e.video,georeference:e.georeference,opacity:e.opacity}));for(const u in t)r[u]=t[u];return r}return(e,t)=>L(e.$slots,"default")}}),J=g({name:"VaMediaLayer",components:{VaLayerHitEvents:N,MediaTry:I},props:G,emits:M,setup(a,{emit:s}){const o=D(),c=o.map,i=Y(s),n=new A({...a.defaultOptions});return j(()=>{n.source=a.source}),O(c,n,a),b(n,a),h("vaMediaLayer",n),h("vaLayer",n),s("load",{layer:n,view:o}),{hitEmits:i}}});function K(a,s,o,c,i,n){const f=_("VaLayerHitEvents"),d=_("MediaTry");return F(),U(q,null,[v(f,W(a.hitEmits),null,16),L(a.$slots,"default"),v(d)],64)}const m=C(J,[["render",K]]);m.install=a=>{a.component(m.name||"VaMediaLayer",m)};export{m as V,ae as c,M as e,z as u};
