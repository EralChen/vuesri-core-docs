import{V as R}from"./chunk-f-qDskxj.js";import{V as O}from"./chunk-HbTg3DvT.js";import{u as S}from"./chunk-QlMQA5MY.js";import{gT as $,gZ as I,U as z,lC as A,gV as U,gW as b,lE as j,hc as H,h0 as B,h1 as F,h4 as E,h2 as i,h6 as p}from"./chunk-r79-UitW.js";import{s as N}from"./chunk-B3AFDltd.js";import{c as P}from"./chunk-X1l1T6Lo.js";import{V as q}from"./chunk-Z_IYtaAq.js";import"./chunk-Y0Vu1B5E.js";import"./chunk-ENCxAf3G.js";import"./chunk-c4b-Yaea.js";import"./chunk-CaitbKEY.js";import"./chunk-woU6z8Ei.js";import"./chunk-lYyaG9p-.js";import"./chunk-1e5GIKf6.js";import"./chunk-GaQCtJAj.js";import"./chunk-VeTFGOxM.js";import"./chunk-Qgrzwe6s.js";import"./chunk-NxD5GeLy.js";import"./chunk-DH-o2pOi.js";function D(){const e=$("vaWmtsLayer");if(!e)throw new Error("The component which use useWmtsLayer() must be in a WmtsLayer component");return e}const X={modelValue:{type:Object,default:()=>({})}},Z={click:e=>e},G=I({name:"VaWmtsLayerOnClick",props:X,emits:Z,setup(e,{emit:a}){const o=S(),t=D(),r=o[N],u=P(r),n=new u("click",async d=>{const{event:M}=d,l=t.activeLayer;await t.when();const f=M.mapPoint,y=l.id,m=l.tileMatrixSet.tileInfo,h=m.origin,k=o.zoom,s=m.lods.find(C=>C.level===k+1);if(!s)return;const[L,v]=m.size,w=(f.x-h.x)/(s.resolution*L),_=(h.y-f.y)/(s.resolution*v);var V=Math.floor(w),T=Math.floor(_);const W=Math.round((w-V)*L),x=Math.round((_-T)*v);let g;y&&(g=await z(t.url,{query:{SERVICE:"WMTS",LAYER:y,REQUEST:"GetFeatureInfo",VERSION:"1.0.0",INFOFORMAT:"application/json",TILECOL:V,TILEROW:T,TILEMATRIX:s.levelValue,TILEMATRIXSET:l.tileMatrixSet.id,I:W,J:x}}).catch(()=>{})),a("click",{...d,requestResponse:g})});return n.add(),A(()=>{n.remove()}),U(()=>{n.remove()}),b(()=>{n.add()}),{}}});function J(e,a,o,t,r,u){return H(e.$slots,"default")}const c=j(G,[["render",J]]);c.install=e=>{e.component(c.name,c)};const K="http://192.168.110.10:36800/zzserver/gwc/service/wmts",Lt=I({__name:"basic",setup(e){const a=t=>{const r=t.view;console.log("wmtsLayerLoad",t.layer),t.layer.when().then(()=>{t.layer.activeLayer?.fullExtent&&r.goTo(t.layer.activeLayer.fullExtent)})},o=t=>{console.log("layerClick",t)};return(t,r)=>(B(),F(i(R),{"default-options":{zoom:2}},{default:E(()=>[p(i(O),{type:"vec_w",anno:!1,"spatial-reference":{wkid:3857}}),p(i(q),{url:K,title:"testLayer","service-mode":"KVP",onLoad:a},{default:E(()=>[p(i(c),{onClick:o})]),_:1})]),_:1}))}});export{Lt as default};
