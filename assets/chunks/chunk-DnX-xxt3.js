import{V as P}from"./chunk-DjXdGIkr.js";import{V as J}from"./chunk-CD3FIDfI.js";import{V as M}from"./chunk-C9tqeO9j.js";import{R as U}from"./chunk-zKPkODU6.js";import{V as W}from"./chunk-CLQIQQkk.js";import{s as b,qE as m,qF as F,qG as j,qH as k,qI as O,qJ as A,qK as Q,qL as H,qM as K,qN as f,a7 as T,qO as z,qP as X,qQ as Y,qR as $,qS as Z,qT as ee,g$ as ae,hg as I,ha as te,h2 as re,h3 as ie,h6 as y,hc as ne,h7 as h,h8 as D,h4 as w,E as oe,bd as se}from"./chunk-YzRi88Dj.js";import"./chunk-BxGO9xbL.js";import"./chunk-BHw4eVQu.js";import"./chunk-DHvBO4SR.js";import"./chunk-BCOlSIf9.js";import"./chunk-Ch0SDxT-.js";import"./chunk-mQ0J7OJ8.js";import"./chunk-Da7lMuRe.js";import"./chunk-CFLxDY7g.js";import"./chunk-B7IxsrlQ.js";/* empty css              */import"./chunk-BJmFAILw.js";import"./chunk-DlgRifwZ.js";import"./chunk-lA_W8v3a.js";import"./chunk-BkUj7kCJ.js";import"./chunk-CurIDYYZ.js";import"./chunk-CuewZUm5.js";import"./chunk-Clcwg9Qm.js";import"./chunk-ByM7454y.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */const me=H;async function le(a){if(!a?.layer||!a.view)throw new b("heatmap-statistics:missing-parameters","'layer' and 'view' parameters are required");const e=[m.CSVLayer,m.FeatureLayer,m.GeoJSONLayer,m.OGCFeatureLayer,m.OrientedImageryLayer,m.WFSLayer],{layer:i,...o}=a,n=F(i,e);if(!n)throw new b("heatmap-statistics:invalid-parameters","'layer' must be one of these types: "+j(e).join(", "));const t={layerAdapter:n,...o};t.radius=t.radius==null?t.blurRadius==null?18:k(t.blurRadius):t.radius;const c=t.signal!=null?{signal:t.signal}:null;await n.load(c);const u=t.field,s=u?n.getField(u):null,r=await O({field:u}),l=A(n,r,"heatmap-statistics:invalid-parameters");if(l)throw l;if(s){const p=Q(n,s,"heatmap-statistics:invalid-parameters",me);if(p)throw p}return t}async function pe(a){const{layerAdapter:e,...i}=await le(a);return e.heatmapStatistics(i)}const x=.01;async function ce(a){if(!a?.layer||!a.view)throw new b("heatmap-renderer:missing-parameters","'layer' and 'view' parameters are required");const e={...a,layer:a.layer,view:a.view};e.radius??=e.blurRadius==null?18:k(e.blurRadius),e.minRatio??=.01,e.maxRatio??=1,e.fadeRatio??=.2,e.fadeToTransparent??=!0;const i=[m.CSVLayer,m.FeatureLayer,m.GeoJSONLayer,m.OGCFeatureLayer,m.OrientedImageryLayer,m.StreamLayer,m.WFSLayer],o=F(e.layer,i);if(!o)throw new b("heatmap-renderer:invalid-parameters","'layer' must be one of these types: "+j(i).join(", "));e.layer=o;const n=e.signal!=null?{signal:e.signal}:null;await o.load(n);const t=await O({field:e.field}),c=K(o,t,"heatmap-renderer:invalid-parameters");if(c)throw c;return e}async function ue(a){let e=a.scheme,i=null,o=null;const n=await Z(a.basemap,a.view);if(i=n.basemapId!=null?n.basemapId:null,o=n.basemapTheme!=null?n.basemapTheme:null,e)return{scheme:$(e),basemapId:i,basemapTheme:o};const t=ee({basemapTheme:o});return t&&(e=t.primaryScheme,i=t.basemapId,o=t.basemapTheme),{scheme:e,basemapId:i,basemapTheme:o}}async function de(a,e){const{field:i,basemap:o,radius:n,fadeToTransparent:t,heatmapScheme:c,view:u}=e,{scheme:s,basemapId:r,basemapTheme:l}=await ue({basemap:o,scheme:c,view:u}),p=s.colors,R=p.length,q=a.min==null,L=q?[0,.04]:[a.min,a.max];let S;const V=e.fadeRatio??0,E=e.maxRatio??0,g=e.minRatio??0,_=(E-g)/(R-1),d=p[0],C=t?g:x,v=[new f({ratio:0,color:new T([d.r,d.g,d.b,0])}),new f({ratio:x,color:new T([d.r,d.g,d.b,0])}),new f({ratio:C,color:new T([d.r,d.g,d.b,C])})];return z(p,R).forEach((N,B)=>{const G=g+_*B;v.push(new f({ratio:G,color:N}))}),t&&(ye(v,V),S=new X({fadeRatio:V})),{renderer:new Y({authoringInfo:S,radius:n,colorStops:v,field:i,minDensity:L[0],maxDensity:L[1]}),statistics:a,defaultValuesUsed:q,scheme:$(s),basemapId:r,basemapTheme:l}}function ye(a,e){const i=10*(1-e)+1,o=a.length-3,n=a[2].color.a;a.forEach((t,c)=>{if(c<=2)return;const{color:u}=t,s=(c-3)/o;u.a=e===0?1:Math.min(Math.max(s*i+s+n,n),1)})}async function he(a){const e=await ce(a);return de(e.statistics??await pe({layer:e.layer,field:e.field,radius:e.radius,view:e.view,signal:e.signal}),e)}const fe=new U({baseURL:"/data"}),we=()=>fe.request({method:"GET",url:"/point1.json"}).then(a=>a[0]),va=ae({__name:"index",setup(a){const e=I(),i=I([]),o=()=>{we().then(s=>{i.value=s.centerPoints.map((r,l)=>new oe({geometry:new se({longitude:r.centerPoint[0],latitude:r.centerPoint[1]}),attributes:{probabilityDensity:r.probabilityDensity,ranking:r.ranking,ObjectID:l}}))})};o();const n=s=>{const{result:r}=s;r&&console.log(r)},t=async s=>{const r=s.layer,l=s.view;await r.when(),l.goTo(i.value);const p=await he({layer:r,view:l,field:"probabilityDensity"});console.log(p),e.value=p.renderer},c=()=>{o()},u=()=>{i.value=[]};return(s,r)=>{const l=te("ElButton");return re(),ie(w(J),null,{before:y(()=>[ne("p",null,[h(l,{onClick:r[0]||(r[0]=p=>c())},{default:y(()=>r[1]||(r[1]=[D("getTestData")])),_:1}),h(l,{onClick:u},{default:y(()=>r[2]||(r[2]=[D("清空")])),_:1})])]),default:y(()=>[h(w(M),{type:"img_w",spatialReference:{wkid:3857}}),h(w(W),null,{default:y(({spatialReference:p})=>[h(w(P),{spatialReference:p,renderer:e.value,source:i.value,fields:[{name:"ObjectID",type:"oid"},{name:"probabilityDensity",type:"double"},{name:"ranking",type:"double"}],"geometry-type":"point","object-id-field":"ObjectID",cursor:"pointer",onClick:n,onChange:t},null,8,["spatialReference","renderer","source"])]),_:1})]),_:1})}}});export{va as default};
