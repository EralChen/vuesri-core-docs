import{kx as g,ky as O,kz as k,kA as a,J as w,kB as z,d7 as C,kC as f,ce as F,a5 as H,kD as M,kE as j,kF as B,bs as G,A as L,e8 as S,da as b,hC as P,dR as W,dd as T,a1 as p,a2 as m,a4 as q,hD as D,e9 as I,bq as R}from"./chunk-CGsGeN7j.js";import{a as J}from"./chunk-B1rJPYh8.js";function V(e,n,t,s){if(n==null||s==null)return!1;const i=g(n,O),r=g(s,k);if(i===r&&i!==a.UNKNOWN||w(n,s))return t[0]=1,t[1]=1,t[2]=1,!0;if(i===a.SPHERICAL_ECEF){const c=z(e),u=c/Math.sqrt(e[0]*e[0]+e[1]*e[1]),d=c/C.radius;if(r===a.WEB_MERCATOR)return t[0]=u*d,t[1]=u*d,t[2]=1,!0;if(r===a.WGS84||r===a.CGCS2000){const o=f;return t[0]=o*u*d,t[1]=o*d,t[2]=1,!0}}else if(i===a.PLATE_CARREE){if(r===a.WGS84||r===a.CGCS2000)return t[0]=f,t[1]=f,t[2]=1,!0;if(r===a.WEB_MERCATOR){const c=e[1]/C.radius;return t[0]=1,t[1]=1/Math.cos(c),t[2]=1,!0}}return!1}let h=class extends F.EventedMixin(H){constructor(e){super(e),this._tmpEvent=new M,this._renderCoordsHelper=e.view.renderCoordsHelper,this._renderSR=this._renderCoordsHelper.spatialReference,this._layerElevationSource=e.layerElevationSource}initialize(){this._intersector=j(this.view.state.viewingMode),this._intersector.options.store=B.MIN,this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"}get spatialReference(){return this.view?.elevationProvider?.spatialReference}getElevation(e,n,t,s){const i=this._renderCoordsHelper,r=G(l,e,n,t);if(!i.toRenderCoords(r,s,r))return L.getLogger(this).error("could not project point to compute elevation"),null;const{layerElevationSource:c,_intersector:u,intersectionHandler:d}=this,o=c.fullExtent,_=o!=null&&Number.isFinite(o.xmin)&&Number.isFinite(o.xmax)&&Number.isFinite(o.ymin)&&Number.isFinite(o.ymax)&&Number.isFinite(o.zmin)&&Number.isFinite(o.zmax)?new S(o.zmin,o.zmax):c.elevationRange;if(_==null)return null;const x=c.elevationOffset,A=_.elevationRangeMin+x,N=_.elevationRangeMax+x,E=i.setAltitude(K,N,r),y=i.setAltitude(U,A,r);return u.reset(E,y,null),d.intersect(u,null,E,y,null,!0),u.results.min.getIntersectionPoint(r)?i.getAltitude(r):null}getSphereElevationBounds(e,n){return J(e,n,$,this._renderSR),this._layerElevationSource.getElevationRange($)}getRootElevationBounds(){const e=this.layerElevationSource.fullExtent;return e?.hasZ?new S(e.zmin,e.zmax):null}objectsChanged(e){this.spatialReference&&(this._computeLayerExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}objectChanged(e){this.spatialReference&&(this._computeObjectExtent(e,this._tmpEvent.extent),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))}_computeObjectExtent(e,n){b(n),this._expandExtent(e,n)}_computeLayerExtent(e,n){b(n);for(const t of e)this._expandExtent(t,n)}_expandExtent(e,n){const t=this.spatialReference;if(t==null||e==null)return;P(v,e.quaternion),v[12]=e.center[0],v[13]=e.center[1],v[14]=e.center[2];const s=e.halfSize;for(let i=0;i<8;++i)l[0]=1&i?s[0]:-s[0],l[1]=2&i?s[1]:-s[1],l[2]=4&i?s[2]:-s[2],W(l,l,v),this._renderCoordsHelper.fromRenderCoords(l,l,t),T(n,l,n)}};p([m({constructOnly:!0})],h.prototype,"layerElevationSource",void 0),p([m({constructOnly:!0})],h.prototype,"intersectionHandler",void 0),p([m({constructOnly:!0})],h.prototype,"view",void 0),p([m()],h.prototype,"spatialReference",null),h=p([q("esri.views.3d.layers.i3s.LayerElevationProvider")],h);const v=D(),$=I(0,0,0,0),l=R(),K=R(),U=R();export{V as f,h as x};
