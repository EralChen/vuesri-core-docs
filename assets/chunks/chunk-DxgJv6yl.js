import{hj as w,hk as O,hl as P,hm as q,s as U,a7 as j,hn as E,ho as V,fO as W,hp as z}from"./chunk-CMhy9c9G.js";import{t as C,e as G,d as D,l as H}from"./chunk-D5HkvLxU.js";import"./chunk-ByM7454y.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-DkqiPko-.js";import"./chunk-8WtPGj6h.js";const T="picture-fill",I="picture-marker",$="simple-fill",J="simple-line",K="simple-marker",N="text",Q="Aa",X=C.size,L=C.maxSize,Y=C.maxOutlineSize,F=C.lineWidth,Z=225,_=document.createElement("canvas");function R(e,t){const i=_.getContext("2d"),a=[];t&&(t.weight&&a.push(t.weight),t.size&&a.push(t.size+"px"),t.family&&a.push(t.family)),i.font=a.join(" ");const{width:r,actualBoundingBoxLeft:l,actualBoundingBoxRight:f,actualBoundingBoxAscent:h,actualBoundingBoxDescent:m}=i.measureText(e);return{width:Math.ceil(Math.max(r,l+f)),height:Math.ceil(h+m),x:Math.floor(l),y:Math.floor((h-m)/2)}}function x(e){const t=e?.size;return{width:t!=null&&typeof t=="object"&&"width"in t?w(t.width):null,height:t!=null&&typeof t=="object"&&"height"in t?w(t.height):null}}async function tt(e,t){const i=t.fill,a=e.color;if(i?.type==="pattern"&&a&&e.type!==T){const r=await V(i.src,a.toCss(!0));i.src=r,t.fill=i}}async function et(e,t,i,a){if(!("font"in e)||!e.font||t.shape.type!=="text")return;try{await W(e.font)}catch{}const{width:r,height:l}=x(a);if(!/[\uE600-\uE6FF]/.test(t.shape.text)){const{width:f,height:h,x:m,y:p}=R(t.shape.text,{weight:t.font?.weight,size:t.font?.size,family:t.font?.family});i[0]=r??f,i[1]=l??h,t.shape.x=m,t.shape.y=p;let d="angle"in e?e.angle:null;if(a?.rotation!=null&&(d=(d??0)+a.rotation),d){const o=d*(Math.PI/180),n=Math.abs(Math.sin(o)),b=Math.abs(Math.cos(o));i[1]=i[0]*n+i[1]*b}}}function at(e,t,i,a,r){if(e.haloColor!=null&&e.haloSize!=null){r.masking??=i.map(()=>[]);const l=w(e.haloSize);a[0]+=l,a[1]+=l,i.unshift([{...t,fill:null,stroke:{color:e.haloColor,width:2*l,join:"round",cap:"round"}}]),r.masking.unshift([{shape:{type:"rect",x:0,y:0,width:a[0]+2*z,height:a[1]+2*z},fill:[255,255,255],stroke:null},{...t,fill:[0,0,0,0],stroke:null}])}e.backgroundColor==null&&e.borderLineColor==null||(a[0]+=2*z,a[1]+=2*z,i.unshift([{shape:{type:"rect",x:0,y:0,width:a[0],height:a[1]},fill:e.backgroundColor,stroke:{color:e.borderLineColor,width:w(e.borderLineSize)}}]),r.masking?.unshift([]))}function A(e,t){return e>t?"dark":"light"}function it(e,t){const i=typeof t?.size=="number"?t?.size:null,a=i!=null?w(i):null,r=t?.maxSize!=null?w(t.maxSize):null;let l="angle"in e?e.angle:null;t?.rotation!=null&&(l=(l??0)+t.rotation);const f=O(e);let h=P(e);ot(e,245)!=="dark"||t?.ignoreWhiteSymbols||(h={width:.75,...h,color:"#bdc3c7"});const m={shape:null,fill:f,stroke:h,offset:[0,0]};h?.width&&(h.width=Math.min(h.width,Y));const p=h?.width||0;let d=t?.size!=null&&(t?.scale==null||t?.scale),o=0,n=0,b=!1;switch(e.type){case K:{const c=e.style,{width:u,height:s}=x(t),v=u===s&&u!=null?u:a??Math.min(w(e.size),r||L);switch(o=v,n=v,c){case"circle":m.shape={type:"circle",cx:0,cy:0,r:.5*v},d||(o+=p,n+=p);break;case"cross":m.shape={type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[o,.5*n]},{command:"M",values:[.5*o,0]},{command:"L",values:[.5*o,n]}]};break;case"diamond":m.shape={type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,.5*n]},{command:"L",values:[.5*o,n]},{command:"Z",values:[]}]},d||(o+=p,n+=p);break;case"square":m.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,0]},{command:"L",values:[o,n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]},d||(o+=p,n+=p),l&&(b=!0);break;case"triangle":m.shape={type:"path",path:[{command:"M",values:[.5*o,0]},{command:"L",values:[o,n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]},d||(o+=p,n+=p),l&&(b=!0);break;case"x":m.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,n]},{command:"M",values:[o,0]},{command:"L",values:[0,n]}]},l&&(b=!0);break;case"path":m.shape={type:"path",path:e.path||""},d||(o+=p,n+=p),l&&(b=!0),d=!0}break}case J:{const{width:c,height:u}=x(t),s=q(h).reduce((S,M)=>S+M,0),v=s&&Math.ceil(F/s),y=u??a??p,g=c??(s*v||F);h&&(h.width=y),o=g,n=y,d=!0,m.shape={type:"path",path:[{command:"M",values:[y/2,n/2]},{command:"L",values:[o-y/2,n/2]}]};break}case T:case $:{const c=typeof t?.symbolConfig=="object"&&!!t?.symbolConfig?.isSquareFill,{width:u,height:s}=x(t);o=!c&&u!==s||u==null?a??X:u,n=!c&&u!==s||s==null?o:s,d||(o+=p,n+=p),d=!0,m.shape=c?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,0]},{command:"L",values:[o,n]},{command:"L",values:[0,n]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:G.fill[0];break}case I:{const c=Math.min(w(e.width),r||L),u=Math.min(w(e.height),r||L),{width:s,height:v}=x(t),y=s===v&&s!=null?s:a??Math.max(c,u),g=c/u;o=g<=1?Math.ceil(y*g):y,n=g<=1?y:Math.ceil(y/g),m.shape={type:"image",x:-Math.round(o/2),y:-Math.round(n/2),width:o,height:n,src:e.url||""},l&&(b=!0);break}case N:{const c=e,u=t?.overrideText||c.text||Q,s=c.font,{width:v,height:y}=x(t),g=y??a??Math.min(w(s.size),r||L),{width:S,height:M}=R(u,{weight:s.weight,size:g,family:s.family}),k=/[\uE600-\uE6FF]/.test(u);o=v??(k?g:S),n=k?g:M;let B=.5*(k?g:M);k&&(B+=5),m.shape={type:"text",text:u,x:c.xoffset||0,y:c.yoffset||B,align:"middle",alignBaseline:c.verticalAlignment,decoration:s&&s.decoration,rotated:c.rotated,kerning:c.kerning},m.font=s&&{size:g,style:s.style,decoration:s.decoration,weight:s.weight,family:s.family};break}}return{shapeDescriptor:m,size:[o,n],renderOptions:{node:t?.node,scale:d,opacity:t?.opacity,rotations:[l],useRotationSize:b,effectView:t?.effectView,ariaLabel:t?.ariaLabel}}}async function Wt(e,t){const{shapeDescriptor:i,size:a,renderOptions:r}=it(e,t);if(!i.shape)throw new U("symbolPreview: renderPreviewHTML2D","symbol not supported.");await tt(e,i),await et(e,i,a,t);const l=[[i]];if(typeof t?.symbolConfig=="object"&&t?.symbolConfig?.applyColorModulation){const f=.6*a[0];l.unshift([{...i,offset:[-f,0],fill:D(i.fill,-.3)}]),l.push([{...i,offset:[f,0],fill:D(i.fill,.3)}]),a[0]+=2*f,r.scale=!1}return e.type==="text"&&at(e,i,l,a,r),H(l,a,r)}function ot(e,t=Z){const i=O(e),a=P(e),r=!i||"type"in i?null:new j(i),l=a?.color?new j(a?.color):null,f=r?A(E(r),t):null,h=l?A(E(l),t):null;return h?f?f===h?f:t>=Z?"light":"dark":h:f}export{ot as getContrastingBackgroundTheme,it as getRenderSymbolParameters,Wt as previewSymbol2D};
