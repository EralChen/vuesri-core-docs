import{ev as p,bD as n,a1 as d,a4 as l}from"./chunk-CMhy9c9G.js";import{N as h}from"./chunk-BM2TxOlh.js";import{m as g}from"./chunk-C3QA3R3E.js";import"./chunk-ByM7454y.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-CgSr3-7H.js";import"./chunk-CS1tf3PV.js";import"./chunk-ijmlzgPk.js";import"./chunk-CbidHm8R.js";import"./chunk-DmemvuQy.js";import"./chunk-CmN077Ld.js";import"./chunk-DjDIt6nn.js";let a=class extends g(h){constructor(){super(...arguments),this.type="imagery-3d",this.redrawDebounced=p(async t=>{this.redraw((i,e)=>this._redrawImage(i,e),t)},2e3)}initialize(){this.addHandles([n(()=>this.view.basemapTerrain.ready,()=>this._initializeMaximumDataResolution(),{once:!0,initial:!0}),this.layer.on("redraw",()=>this._updatingHandles.addPromise(this.redrawDebounced()))]),this._updatingHandles.add(()=>this.layer?.exportImageServiceParameters?.version,()=>{this._updatingHandles.addPromise(this.refreshDebounced())}),this._updatingHandles.add(()=>this.layer?.renderer,()=>{this._updatingHandles.addPromise(this.refreshDebounced())}),this._updatingHandles.add(()=>this.timeExtent,()=>this._updatingHandles.addPromise(this.refreshDebounced()))}_initializeMaximumDataResolution(){this.maximumDataResolution=this.layer.loaded?this.layer.serviceRasterInfo.pixelSize:null}getFetchOptions(){return{timeExtent:this.timeExtent}}async processResult(t,i,e){i.imageOrCanvasElement?t.image=i.imageOrCanvasElement:(t.image=document.createElement("canvas"),t.pixelData=i.pixelData,await this._redrawImage(t,e))}async _redrawImage(t,i){if(!(t.image instanceof HTMLCanvasElement)||t.pixelData==null)throw new Error;const e=t.image,s=e.getContext("2d"),m=await this.layer.applyRenderer(t.pixelData,{signal:i}),r=this.layer.applyFilter(m).pixelBlock;if(r==null)throw new Error;e.width=r.width,e.height=r.height;const o=s.createImageData(r.width,r.height);o.data.set(r.getAsRGBA()),s.putImageData(o,0,0)}};a=d([l("esri.views.3d.layers.ImageryLayerView3D")],a);const rt=a;export{rt as default};
