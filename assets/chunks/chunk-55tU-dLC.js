import{a_ as x,aB as Q,ix as yt,b4 as q,cy as nt,sn as z,sV as It,sW as Nt,fa as lt,cv as st,fb as ut,bB as ft,gf as gt,cw as $t,nC as X,sX as xt,bC as dt,bq as F,sY as At}from"./chunk-CMhy9c9G.js";import{RegularEdgeInstancesLayout as K,SilhouetteEdgeInstancesLayout as Y,EdgeInputBufferLayout as vt}from"./chunk-DDtA4eik.js";class St{constructor(){this.position0=x(),this.position1=x(),this.faceNormal0=x(),this.faceNormal1=x(),this.componentIndex=0,this.cosAngle=0}}const k=-1;function bt(t,n,s){const a=t.vertices.position,i=t.vertices.componentIndex,u=m.position0,d=m.position1,p=m.faceNormal0,I=m.faceNormal1,{edges:r,normals:f}=Bt(t),w=r.length/4,N=n.allocate(w);let _=0;const C=w,A=s?.allocate(C);let T=0,e=0,o=0;U.length=0;for(let g=0;g<w;++g){const S=4*g;a.getVec(r.data[S],u),a.getVec(r.data[S+1],d);const E=U.pushNew();E.index=4*g,E.length=yt(u,d)}U.sort((g,S)=>S.length-g.length);const l=new Array,c=new Array;U.forAll(({length:g,index:S})=>{const E=r.data[S],wt=r.data[S+1],Z=r.data[S+2],tt=r.data[S+3],et=tt===k;if(a.getVec(E,u),a.getVec(wt,d),et){const $=3*Z;q(p,f.data[$],f.data[$+1],f.data[$+2]),nt(I,p),m.componentIndex=i.get(E),m.cosAngle=z(p,I)}else{let $=3*Z;if(q(p,f.data[$],f.data[$+1],f.data[$+2]),$=3*tt,q(I,f.data[$],f.data[$+1],f.data[$+2]),m.componentIndex=i.get(E),m.cosAngle=z(p,I),Vt(m,Mt))return;m.cosAngle<-.9999&&nt(I,p)}e+=g,o++,et||Lt(m,Ct)?(n.write(N,_++,m),l.push(g)):_t(m,pt)&&(A&&s&&s.write(A,T++,m),c.push(g))});const y=new Float32Array(l.reverse()),v=new Float32Array(c.reverse()),b=A&&s?{instancesData:A.slice(0,T),lodInfo:{lengths:v}}:void 0;return{regular:{instancesData:N.slice(0,_),lodInfo:{lengths:y}},silhouette:b,averageEdgeLength:e/o}}function Lt(t,n){return t.cosAngle<n}function Vt(t,n){return t.cosAngle>n}function _t(t,n){const s=It(t.cosAngle);return Nt(ot,t.position1,t.position0),s*(z(lt(Ot,t.faceNormal0,t.faceNormal1),ot)>0?-1:1)>n}function Bt(t){const n=t.faces.length/3,s=t.faces,a=t.neighbors,i=t.vertices.position;h.length=H.length=0;for(let u=0;u<n;u++){const d=3*u,p=a[d],I=a[d+1],r=a[d+2],f=s[d],w=s[d+1],N=s[d+2];i.getVec(f,B),i.getVec(w,W),i.getVec(N,D),st(W,W,B),st(D,D,B),lt(B,W,D),ut(B,B),H.pushArray(B),(p===k||f<w)&&(h.push(f),h.push(w),h.push(u),h.push(p)),(I===k||w<N)&&(h.push(w),h.push(N),h.push(u),h.push(I)),(r===k||N<f)&&(h.push(N),h.push(f),h.push(u),h.push(r))}return{edges:h,normals:H}}class Et{constructor(){this.index=0,this.length=0}}const U=new Q({allocator:t=>t||new Et,deallocator:null}),h=new Q({deallocator:null}),H=new Q({deallocator:null}),m=new St,Ot=x(),ot=x(),B=x(),W=x(),D=x(),pt=ft(4),Mt=Math.cos(pt),Pt=ft(35),Ct=Math.cos(Pt);function at(t,n,s){const a=n/3,i=new Uint32Array(s+1),u=new Uint32Array(s+1),d=(e,o)=>{e<o?i[e+1]++:u[o+1]++};for(let e=0;e<a;e++){const o=t[3*e],l=t[3*e+1],c=t[3*e+2];d(o,l),d(l,c),d(c,o)}let p=0,I=0;for(let e=0;e<s;e++){const o=i[e+1],l=u[e+1];i[e+1]=p,u[e+1]=I,p+=o,I+=l}const r=new Uint32Array(6*a),f=i[s],w=(e,o,l)=>{if(e<o){const c=i[e+1]++;r[2*c]=o,r[2*c+1]=l}else{const c=u[o+1]++;r[2*f+2*c]=e,r[2*f+2*c+1]=l}};for(let e=0;e<a;e++){const o=t[3*e],l=t[3*e+1],c=t[3*e+2];w(o,l,e),w(l,c,e),w(c,o,e)}const N=(e,o)=>{const l=2*e,c=o-e;for(let y=1;y<c;y++){const v=r[l+2*y],b=r[l+2*y+1];let g=y-1;for(;g>=0&&r[l+2*g]>v;g--)r[l+2*g+2]=r[l+2*g],r[l+2*g+3]=r[l+2*g+1];r[l+2*g+2]=v,r[l+2*g+3]=b}};for(let e=0;e<s;e++)N(i[e],i[e+1]),N(f+u[e],f+u[e+1]);const _=new Int32Array(3*a),C=(e,o)=>e===t[3*o]?0:e===t[3*o+1]?1:e===t[3*o+2]?2:-1,A=(e,o)=>{const l=C(e,o);_[3*o+l]=-1},T=(e,o,l,c)=>{const y=C(e,o);_[3*o+y]=c;const v=C(l,c);_[3*c+v]=o};for(let e=0;e<s;e++){let o=i[e];const l=i[e+1];let c=u[e];const y=u[e+1];for(;o<l&&c<y;){const v=r[2*o],b=r[2*f+2*c];v===b?(T(e,r[2*o+1],b,r[2*f+2*c+1]),o++,c++):v<b?(A(e,r[2*o+1]),o++):(A(b,r[2*f+2*c+1]),c++)}for(;o<l;)A(e,r[2*o+1]),o++;for(;c<y;)A(r[2*f+2*c],r[2*f+2*c+1]),c++}return _}const R=.7;let ht=class{updateSettings(n){this.settings=n,this._edgeHashFunction=n.reducedPrecision?Tt:Ft}write(n,s,a){j.seed=this._edgeHashFunction(a);const i=j.getIntRange(0,255),u=j.getIntRange(0,this.settings.variants-1),d=j.getFloat(),p=255*(.5*Ut(-(1-Math.min(d/R,1))+Math.max(0,d-R)/(1-R),1.2)+.5);n.position0.setVec(s,a.position0),n.position1.setVec(s,a.position1),n.componentIndex.set(s,a.componentIndex),n.variantOffset.set(s,i),n.variantStroke.set(s,u),n.variantExtension.set(s,p)}};const L=new Float32Array(6),V=new Uint32Array(L.buffer),P=new Uint32Array(1);function Ft(t){return L[0]=t.position0[0],L[1]=t.position0[1],L[2]=t.position0[2],L[3]=t.position1[0],L[4]=t.position1[1],L[5]=t.position1[2],P[0]=31*(31*(31*(31*(31*(166811+V[0])+V[1])+V[2])+V[3])+V[4])+V[5],P[0]}function Tt(t){const n=L;n[0]=O(t.position0[0]),n[1]=O(t.position0[1]),n[2]=O(t.position0[2]),n[3]=O(t.position1[0]),n[4]=O(t.position1[1]),n[5]=O(t.position1[2]),P[0]=5381;for(let s=0;s<V.length;s++)P[0]=31*P[0]+V[s];return P[0]}const rt=1e4;function O(t){return Math.round(t*rt)/rt}function Ut(t,n){return Math.abs(t)**n*Math.sign(t)}class G{constructor(){this._commonWriter=new ht}updateSettings(n){this._commonWriter.updateSettings(n)}allocate(n){return K.createBuffer(n)}write(n,s,a){this._commonWriter.write(n,s,a),$t(M,a.faceNormal0,a.faceNormal1),ut(M,M);const{typedBuffer:i,typedBufferStride:u}=n.normalCompressed;X(i,s,M[0],M[1],M[2],u)}}G.Layout=K,G.glLayout=gt(K,1);class J{constructor(){this._commonWriter=new ht}updateSettings(n){this._commonWriter.updateSettings(n)}allocate(n){return Y.createBuffer(n)}write(n,s,a){this._commonWriter.write(n,s,a);{const{typedBuffer:i,typedBufferStride:u}=n.normalCompressed;X(i,s,a.faceNormal0[0],a.faceNormal0[1],a.faceNormal0[2],u)}{const{typedBuffer:i,typedBufferStride:u}=n.normal2Compressed;X(i,s,a.faceNormal1[0],a.faceNormal1[1],a.faceNormal1[2],u)}}}J.Layout=Y,J.glLayout=gt(Y,1);const M=x(),j=new xt;function Wt(t){const n=mt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return it.updateSettings(t.writerSettings),ct.updateSettings(t.writerSettings),bt(n,it,ct)}function mt(t,n,s,a){if(n){const d=at(s,a,t.count);return new Dt(s,a,d,t)}const i=At(t.buffer,t.stride/4,{originalIndices:s,originalIndicesLength:a}),u=at(i.indices,a,i.uniqueCount);return{faces:i.indices,facesLength:i.indices.length,neighbors:u,vertices:vt.createView(i.buffer)}}class Dt{constructor(n,s,a,i){this.faces=n,this.facesLength=s,this.neighbors=a,this.vertices=i}}const it=new G,ct=new J,jt=dt().vec3f(F.POSITION0).vec3f(F.POSITION1),kt=dt().vec3f(F.POSITION0).vec3f(F.POSITION1).u16(F.COMPONENTINDEX),zt=Object.freeze(Object.defineProperty({__proto__:null,extract:Wt,extractComponentsEdgeLocationsLayout:kt,extractEdgeInformation:mt,extractEdgeLocationsLayout:jt},Symbol.toStringTag,{value:"Module"}));export{J as N,jt as d,zt as e,Wt as f,kt as m,bt as p,mt as u,G as w};
