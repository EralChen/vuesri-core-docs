import{u as f}from"./chunk-QlMQA5MY.js";import{gT as m,gY as g,gZ as y,lv as V,ns as _,gX as p,hc as H}from"./chunk-r79-UitW.js";function S(){const o=m("vaParentView");if(!o)throw new Error("No parent view provided");return o}class u extends g{constructor(i,r){super(),this.originView=i,this.targetView=r}add(){this.handler||(this.handler=this.originView.watch("viewpoint",i=>{this.targetView.viewpoint=i}),this.removeHandler=()=>{this.handler?.remove(),this.handler=null})}}const I=y({__name:"index",props:{syncKey:{type:String,default:"__va_derived_view_sync_init__"},synchronization:{type:String,default:"one-way"}},setup(o){const i=o,r=i.syncKey,e=S();e[r]||(e[r]=new Map);const n=f(),c=new u(e,n),a=new u(n,e),l=V(()=>i.synchronization==="two-way");_(()=>{n.when(()=>{e.viewpoint&&(n.viewpoint=e.viewpoint)})}),w();function w(){if(a.remove(),c.handler||(c.add(),!l.value))return;const t=n.watch("interacting, animation",s=>{s&&(c.remove(),e[r].forEach((d,h)=>{h!==n&&d()}),t.remove())})}e[r].set(n,()=>w());const v=e.watch("interacting, animation",t=>{t&&w()});if(p(()=>{v.remove()}),l.value){const t=n.watch("interacting, animation",s=>{if(!s||a.handler)return;a.add();const d=e.watch("interacting, animation",h=>{h&&(a.remove(),d.remove())})});p(()=>{t.remove()})}return(t,s)=>H(t.$slots,"default")}});export{I as _};
