import{p as M,a as $,u as V}from"./chunk-_oFyxSRx.js";import{gS as O,np as b,gY as E,hd as S,lB as T,dg as y,hb as g,gT as k,ly as m,lD as B,h7 as h,g$ as H,h8 as R,h5 as _,oB as j,ha as C}from"./chunk-nmd5K2Af.js";import{V as F,b as v,a as w,c as U}from"./chunk-gPnlrcM9.js";import{u as q}from"./chunk-SsoqVI4I.js";import{_ as x,c as A}from"./chunk-ljfhnYgQ.js";function D(){const a=O("vaMediaLayer");if(!a)throw new Error("The component which use useMediaLayer() must be in a MediaLayer component");return a}const N={...M,defaultOptions:{type:Object,default:()=>({})},source:{type:Object,required:!0,default:()=>({})}},L={load:a=>a,click:a=>a,pointerMove:a=>a},Q=b(L),f="__va_media_layer_retries",W=E({__name:"media-try",setup(a){const s=D(),o=s.source,c=S(),d=[];T(()=>{d.forEach(e=>{e.remove()})}),d.push(s.on("layerview-create",e=>{c.value=e.layerView}));const t=e=>{c.value&&y(()=>!c.value?.updating).then(e)};o instanceof F&&(l(o.elements),o.elements.on("change",()=>{setTimeout(()=>{l(o.elements)},600)}));function l(e){e.filter(r=>r.loadStatus!=="loaded").forEach(r=>{y(()=>r.loadStatus==="failed").then(()=>{t(()=>{const n=e.find(i=>i===r);if(n&&(n[f]??0)<3){e.remove(n);const i=u(n,{[f]:(n[f]??0)+1});e.add(i)}})})})}function u(e,r={}){let n=e;e instanceof v?n=new v({image:e.image,georeference:e.georeference,animationOptions:e.animationOptions,opacity:e.opacity}):e instanceof w&&(n=new w({video:e.video,georeference:e.georeference,opacity:e.opacity}));for(const i in r)n[i]=r[i];return n}return(e,r)=>g(e.$slots,"default")}}),Y=E({name:"VaMediaLayer",components:{VaLayerHitEvents:x,MediaTry:W},props:N,emits:L,setup(a,{emit:s}){const o=q(),c=o.map,d=A(s),t=new U({...a.defaultOptions});return k(()=>{t.source=a.source}),$(c,t,a),V(t,a),m("vaMediaLayer",t),m("vaLayer",t),s("load",{layer:t,view:o}),{hitEmits:d}}});function z(a,s,o,c,d,t){const l=h("VaLayerHitEvents"),u=h("MediaTry");return H(),R(C,null,[_(l,j(a.hitEmits),null,16),g(a.$slots,"default"),_(u)],64)}const p=B(Y,[["render",z]]);p.install=a=>{a.component(p.name||"VaMediaLayer",p)};export{p as V,Q as c,L as e,D as u};
