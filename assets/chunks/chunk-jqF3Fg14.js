import{V as B}from"./chunk-5_Ug66ZV.js";import{gY as v,lu as I,lt as L,oy as j,gW as A,mI as O,hm as W,lD as q,h7 as P,g$ as $,h0 as E,h3 as N,hb as Q,br as U,h4 as R,h1 as M}from"./chunk-7CxtqCyf.js";import{V as D}from"./chunk-YaCNtw1w.js";import{V as J,b as Y,u as Z}from"./chunk-zPZP2vtf.js";import{u as F}from"./chunk-vi6k8Juw.js";import"./chunk-uwAdCIwp.js";import"./chunk-Erz-OJlC.js";import"./chunk-GPoxr-a7.js";import"./chunk-I6BlN4vT.js";import"./chunk-XMzs6jyB.js";import"./chunk-AylNmchf.js";import"./chunk-3pWIFUl5.js";import"./chunk-F-dqogZc.js";import{V as G}from"./chunk-zAQkUzCT.js";import"./chunk-njmlhuJq.js";import"./chunk-7slbu1c1.js";import"./chunk-uA2fvwQa.js";import"./chunk-YmhTTtBw.js";import"./chunk-2bZwrhX9.js";import"./chunk-TurS-MML.js";import"./chunk-MzLJFrM-.js";import"./chunk-3WIQ0bUj.js";import"./chunk-Ef-yoWCO.js";import"./chunk-TRcvuypW.js";import"./chunk-N6XhtgCm.js";import"./chunk-YreEY65c.js";import"./chunk-RWC-e16p.js";import"./chunk-EMHMRnPu.js";import"./chunk-k_IA6j7R.js";import"./chunk-NxAF8eVY.js";import"./chunk-g0pgNt0h.js";import"./chunk-wTF9QXFA.js";import"./chunk-qtGAkQwi.js";import"./chunk-lp4o6A-F.js";import"./chunk-_UpT-DBM.js";import"./chunk-eZQ9keTK.js";import"./chunk-WCrieKyY.js";import"./chunk--XW1MBwo.js";import"./chunk-2Hp3G2JR.js";import"./chunk-2pkhtBZ0.js";import"./chunk-RU9n8ZYe.js";import"./chunk-B3AFDltd.js";import"./chunk-FaUcv7Y1.js";import"./chunk-b3huDAu8.js";import"./chunk-0V4hI-2P.js";import"./chunk-ZXsesHHL.js";import"./chunk-SDu-JZrM.js";import"./chunk-oq2dL9hD.js";import"./chunk-zunlkW0b.js";import"./chunk-vsz5TzuV.js";import"./chunk-rdvVxQgc.js";import"./chunk-L8u31oVu.js";import"./chunk--YZPZ9s2.js";import"./chunk-qpqmZsuK.js";import"./chunk-Z6l_I2WE.js";import"./chunk-OxiGN2dI.js";import"./chunk-KniWwRQm.js";import"./chunk-PoY_6i1j.js";import"./chunk-17-QEu50.js";import"./chunk-cRVp4iPJ.js";import"./chunk-TxRN5qyP.js";import"./chunk-AnONsp03.js";const H={url:{type:String,required:!0},layerName:{type:String,required:!0}},K={load:t=>t};function X(t,u,r="id"){const o=[],s=u.reduce((d,p)=>{const l=p[r];return d.set(l,p),d},new Map),f=t.reduce((d,p)=>{const l=p[r];return s.has(l)?(o.push(p),s.delete(l)):d.set(l,p),d},new Map),c=[...s.values()],m=[...f.values()];return{addMap:s,deleteMap:f,updateRows:o,addRows:c,deleteRows:m}}const ee=v({name:"VaMediaTileLayer",components:{VaMediaLayer:D},props:H,emits:K,setup(t,{emit:u}){const r=F(),o=new J({elements:[]}),s=I(()=>t.url.startsWith("/")?"/"+t.url.split("/")[0]:new URL(t.url).origin),f=e=>{u("load",e)},c=new O,m=L({}),d=()=>{m.layerName=t.layerName,m.scale=r.scale;const e=W(r.extent);m.extent=e.expand(1.5),m.height=r.height,m.width=r.width},p=r.watch("stationary",e=>{e&&V()});c.add(p);const l=j(V,800),S=r.on("drag",()=>{l()});c.add(S),A(()=>{c.removeAll()});const _=L({zoom:0}),h=new Map,T=(e,i)=>{if(h.has(e)){const n=h.get(e);if(n&&n.has(i))return n.get(i)}},b=(e,i,n)=>{h.has(e)||h.set(e,new Map);const a=h.get(e);a&&a.set(i,n)};function V(){d(),k()}function k(){if(t.url)return fetch(t.url,{headers:{"Content-Type":"application/json"},method:"post",body:JSON.stringify(m)}).then(e=>e.json()).then(e=>{const i=o.elements.toArray();let n=!1,a=[];e.zoom!==_.zoom&&(n=!0,a=i),_.zoom=e.zoom;const x=e.elements.reduce((y,g)=>{const C=z(g,e.zoom);return C&&y.push(C),y},[]);if(n)o.elements.addMany(x),setTimeout(()=>{o.elements.removeMany(a)},1e3);else{const{addRows:y,deleteRows:g}=X(i,x,"id");o.elements.addMany(y),o.elements.removeMany(g)}})}function z(e,i){const n=T(i,e.id);if(n)return n;if(e.type==="image"){e.url=s.value+`/${t.layerName}/${e.id}.jpg`;const a=new Y({image:e.url,georeference:new Z({extent:{...e.extent,spatialReference:{wkid:4326}}})});return a.id=e.id,b(i,e.id,a),a}}return{layerLoad:f,source:o}}});function te(t,u,r,o,s,f){const c=P("VaMediaLayer");return $(),E(c,{source:t.source,onLoad:t.layerLoad},{default:N(()=>[Q(t.$slots,"default")]),_:3},8,["source","onLoad"])}const w=q(ee,[["render",te]]);w.install=t=>{t.component(w.name||"VaMediaTileLayer",w)};const re="http://119.3.38.30:8087/layer/media/elements",dt=v({__name:"basic",setup(t){const r={center:new U({xmin:120.86486802,ymin:30.77097798,xmax:121.0061519,ymax:30.93426796,spatialReference:{wkid:4326}}).center,scale:4500};return(o,s)=>($(),E(M(B),{"default-options":r},{default:N(()=>[R(M(G),{type:"vec_w","spatial-reference":{wkid:3857}}),R(M(w),{url:re,"layer-name":"rs1"})]),_:1}))}});export{dt as default};
