import{eE as n,bX as p,a1 as d,a4 as l}from"./chunk-CGsGeN7j.js";import{N as h}from"./chunk-djQiaVJ0.js";import{u}from"./chunk-D0BIAwjY.js";import"./chunk-ByM7454y.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-DRtAJHF_.js";import"./chunk-CBKRTItb.js";import"./chunk-zG9Gebow.js";let r=class extends u(h){constructor(){super(...arguments),this.type="imagery-3d",this.redrawDebounced=n(async t=>{this.redraw((i,e)=>this._redrawImage(i,e),t)},2e3)}initialize(){this.addHandles([p(()=>this.view.basemapTerrain.ready,()=>this._initializeMaximumDataResolution(),{once:!0,initial:!0}),this.layer.on("redraw",()=>this._updatingHandles.addPromise(this.redrawDebounced()))]),this._updatingHandles.add(()=>this.layer?.exportImageServiceParameters?.version,()=>{this._updatingHandles.addPromise(this.refreshDebounced())}),this._updatingHandles.add(()=>this.layer?.renderer,()=>{this._updatingHandles.addPromise(this.refreshDebounced())}),this._updatingHandles.add(()=>this.timeExtent,()=>this._updatingHandles.addPromise(this.refreshDebounced()))}_initializeMaximumDataResolution(){this.maximumDataResolution=this.layer.loaded?this.layer.serviceRasterInfo.pixelSize:null}getFetchOptions(){return{timeExtent:this.timeExtent}}async processResult(t,i,e){i.imageOrCanvasElement?t.image=i.imageOrCanvasElement:(t.image=document.createElement("canvas"),t.pixelData=i.pixelData,await this._redrawImage(t,e))}async _redrawImage(t,i){if(!(t.image instanceof HTMLCanvasElement)||t.pixelData==null)throw new Error;const e=t.image,s=e.getContext("2d"),m=await this.layer.applyRenderer(t.pixelData,{signal:i}),a=this.layer.applyFilter(m).pixelBlock;if(a==null)throw new Error;e.width=a.width,e.height=a.height;const o=s.createImageData(a.width,a.height);o.data.set(a.getAsRGBA()),s.putImageData(o,0,0)}};r=d([l("esri.views.3d.layers.ImageryLayerView3D")],r);const Z=r;export{Z as default};
