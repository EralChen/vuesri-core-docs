import{u as m}from"./chunk-AKK1CEJt.js";import{gT as v,gY as g,gZ as y,lu as V,nt as _,gX as l,hc as H}from"./chunk-5cgByRBI.js";function S(){const o=v("vaParentView");if(!o)throw new Error("No parent view provided");return o}class p extends g{constructor(i,r){super(),this.originView=i,this.targetView=r}add(){this.handler||(this.handler=this.originView.watch("viewpoint",i=>{this.targetView.viewpoint=i}),this.removeHandler=()=>{this.handler?.remove(),this.handler=null})}}const I=y({__name:"index",props:{syncKey:{type:String,default:"__va_derived_view_sync_init__"},synchronization:{type:String,default:"one-way"}},setup(o){const i=o,r=i.syncKey,e=S();e[r]||(e[r]=new Map);const n=m(),c=new p(e,n),a=new p(n,e),u=V(()=>i.synchronization==="two-way");_(()=>{n.when(()=>{e.viewpoint&&(n.viewpoint=e.viewpoint)})}),w();function w(){if(a.remove(),c.handler||(c.add(),!u.value))return;const t=n.watch("interacting, animation",s=>{s&&(c.remove(),e[r].forEach((d,h)=>{h!==n&&d()}),t.remove())})}e[r].set(n,()=>w());const f=e.watch("interacting, animation",t=>{t&&w()});if(l(()=>{f.remove()}),u.value){const t=n.watch("interacting, animation",s=>{if(!s||a.handler)return;a.add();const d=e.watch("interacting, animation",h=>{h&&(a.remove(),d.remove())})});l(()=>{t.remove()})}return(t,s)=>H(t.$slots,"default")}});export{I as _};
