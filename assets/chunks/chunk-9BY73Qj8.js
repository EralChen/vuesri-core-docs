import{V as T}from"./chunk-CD3FIDfI.js";import{V as $}from"./chunk-C9tqeO9j.js";import{V as P}from"./chunk-D_RU80vY.js";import{p as j,a as z,b as B,d as C,e as G,f as I}from"./chunk-BHw4eVQu.js";import{g$ as M,gX as g,lG as F,lL as R,he as k,tC as A,tD as H,a2 as D,a4 as W,h9 as q,hg as L,h2 as N,h3 as U,h6 as v,h7 as d,h4 as m,hc as X,hh as Z}from"./chunk-YzRi88Dj.js";import{u as J}from"./chunk-DGYRbKE9.js";import{V as K,s as Q}from"./chunk-SyfkAsIp.js";import"./chunk-DjOIj6-o.js";import{V as Y}from"./chunk-BRnY4uVr.js";import{V as ee}from"./chunk-Dsi4UQrI.js";import"./chunk-DHvBO4SR.js";import"./chunk-B7IxsrlQ.js";import"./chunk-mQ0J7OJ8.js";import"./chunk-Ch0SDxT-.js";/* empty css              */import"./chunk-BJmFAILw.js";import"./chunk-DlgRifwZ.js";import"./chunk-lA_W8v3a.js";import"./chunk-BkUj7kCJ.js";import"./chunk-CurIDYYZ.js";import"./chunk-CuewZUm5.js";import"./chunk-Clcwg9Qm.js";import"./chunk-CFLxDY7g.js";import"./chunk-BCOlSIf9.js";import"./chunk-ByM7454y.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-_SCJxduo.js";import"./chunk-zKPkODU6.js";import"./chunk-CMTIf1CS.js";import"./chunk-D1eaHFcV.js";import"./chunk-D4KI0uoT.js";import"./chunk-Da7lMuRe.js";const te={...j,defaultOptions:{type:Object,default:()=>({})},source:{type:Array,default:()=>[]},renderer:{type:Object,default:void 0}},re={load:r=>r},oe=M({name:"VaLocalElevationLayer",props:te,emits:re,setup(r,{emit:t}){const o=J(),e=new h({...r.defaultOptions});return g(()=>{e.source=r.source}),g(()=>{r.renderer&&(e.renderer=r.renderer)}),z(o.map.ground.layers,e,r),B(e,r),C(o,r,a=>{e.visible=a}),F("vaLayer",e),t("load",{view:o,layer:e}),{}}});function ae(r,t,o,e,a,n){return k(r.$slots,"default")}const y=R(oe,[["render",ae]]);var se=Object.defineProperty,ie=Object.getOwnPropertyDescriptor,w=(r,t,o,e)=>{for(var a=e>1?void 0:e?ie(t,o):t,n=r.length-1,i;n>=0;n--)(i=r[n])&&(a=(e?i(t,o,a):i(a))||a);return e&&a&&se(t,o,a),a};let h=class extends A{constructor(r){super(r),this.source=[],this.renderer=new V({}),this.elevationMap=new Map,this.reshow=H(this._reshow,400),r.source&&(this.source=r.source),r.renderer&&(this.renderer=r.renderer);const t=this.watch("source",e=>{e?.length&&(this.fullExtent=G(e),this.refresh())}),o=this.watch("renderer",e=>{this.renderer=e,this.refresh()});this.addHandles(t),this.addHandles(o)}initElevationMap(){if(this.elevationMap.clear(),this.renderer.type==="local-elevation-unique-value"){const r=this.renderer;this.source.forEach(t=>{const o=t.attributes[r.field];if(o==null){this.elevationMap.set(t,this.renderer.defaultElevation);return}r.uniqueValueInfos.some(e=>e.value===o?(this.elevationMap.set(t,e.elevation),!0):!1)})}if(this.renderer.type==="local-elevation-geometry"){const r=this.renderer;this.source.forEach(t=>{this.elevationMap.set(t,r.expression(t))})}}async load(r){return await super.load(r)}_reshow(){this.visible=!1,Promise.resolve().then(()=>{this.visible=!0})}refresh(){this.initElevationMap(),this.reshow()}async fetchTile(r,t,o,e){if(!this.source?.length)return null;const[a,n]=this.getTileBounds(r,t,o),i=256,s=i+1,u={values:new Float32Array(s*s).fill(0),width:s,height:s,maxZError:-1e3,noDataValue:e?.noDataValue},f=this.tileInfo?.lods[r].resolution;if(!f)return null;for(let l=0;l<s;l++)for(let c=0;c<s;c++){let E=!1,_=null;this.source.some(x=>{const b=x.geometry;if(b.type!=="polygon")return!1;if(b.rings.some(O=>this.rayCasting([a+c*f,n+l*f],O)))return E=!0,_=x,!0}),u.values[(i-l)*s+c]=E?this.elevationMap.get(_)??this.renderer.defaultElevation:void 0}return u}rayCasting(r,t){const o=r[0],e=r[1];let a=!1;for(let n=0,i=t.length,s=i-1;n<i;s=n,n++){const p=t[n][0],u=t[n][1],f=t[s][0],l=t[s][1];if(p===o&&u===e||f===o&&l===e)return!0;if(u<e&&l>=e||u>=e&&l<e){const c=p+(e-u)*(f-p)/(l-u);if(c===o)return!0;c>o&&(a=!a)}}return a}};w([D()],h.prototype,"source",2);w([D()],h.prototype,"renderer",2);h=w([W("vuesri.core.LocalElevationLayer")],h);class S{constructor(t){this.defaultElevation=-100,t.defaultElevation!==void 0&&(this.defaultElevation=t.defaultElevation)}}class V extends S{constructor(t){super(t),this.type="local-elevation-geometry",this.expression=o=>{const e=o.geometry;return e.type!=="polygon"?this.defaultElevation:this.getPolygonMinz(e)},t.expression&&(this.expression=t.expression)}getPolygonMinz(t){const e=I(t).flat();return Math.min(...e.map(a=>a.z).filter(a=>typeof a=="number"))}}y.install=r=>{r.component(y.name||"VaLocalElevationLayer",y)};const yt=M({__name:"basic",setup(r){const t=q({type:"default",elevation:0}),o=[{templateType:"VkfRadio",prop:"type",label:"Type",options:[{label:"default",value:"default"},{label:"geometry",value:"geometry"}]},{templateType:"VkfSlider",prop:"elevation",label:"Elevation",min:-1e3,max:1e3,templateIf:i=>i?.type==="default"}],e=L([]),a=L(new V({}));g(()=>{t.type==="geometry"?a.value=new V({}):a.value=new S({defaultElevation:t.elevation})});const n=async({view:i,layer:s})=>{await i.when(),await s.when(),i.goTo(s.fullExtent,{animate:!1})};return(i,s)=>(N(),U(m(T),{"default-options":{zoom:2}},{before:v(()=>[d(m(K),{"form-items":o,data:t,onSetData:s[0]||(s[0]=p=>m(Q)(t,p))},null,8,["data"])]),after:v(()=>[X("pre",null,Z(e.value),1)]),default:v(()=>[d(m($),{type:"vec_w",anno:!1,"spatial-reference":{wkid:3857}}),d(m(P),{url:"https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer"}),d(m(y),{source:e.value,renderer:a.value,onLoad:n},null,8,["source","renderer"]),d(m(ee),null,{default:v(()=>[d(m(Y),{modelValue:e.value,"onUpdate:modelValue":s[1]||(s[1]=p=>e.value=p),"available-creature-tools":["polygon"],"default-options":{visibleElements:{selectionTools:{"lasso-selection":!1,"rectangle-selection":!1}}}},null,8,["modelValue"])]),_:1})]),_:1}))}});export{yt as default};
