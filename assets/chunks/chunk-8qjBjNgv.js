import{p as $,a as T,u as O}from"./chunk-P-mZngti.js";import{gT as k,ns as N,gZ as M,he as S,lD as F,bL as h,hc as b,gU as H,lA as v,lF as I,h8 as _,h0 as R,h9 as j,h6 as w,oF as U,hb as A}from"./chunk-5cgByRBI.js";import{V as B,b as E,a as L,c as C}from"./chunk-ABk-8O9b.js";import{u as W}from"./chunk-AKK1CEJt.js";import{_ as q,c as D}from"./chunk-oS8TyLWd.js";function P(){const t=k("vaMediaLayer");if(!t)throw new Error("The component which use useMediaLayer() must be in a MediaLayer component");return t}const Z={...$,defaultOptions:{type:Object,default:()=>({})},source:{type:Object,required:!0,default:()=>({})},retryTimes:{type:Number,default:5},retryInterval:{type:Number,default:1e3}},g={load:t=>t,click:t=>t,pointerMove:t=>t},ee=N(g),f="__va_media_layer_retries",z=M({__name:"media-try",props:{retryTimes:{type:Number,default:5},retryInterval:{type:Number,default:1e3}},setup(t){const i=t,c=P(),o=c.source,l=S(),a=[],u=new WeakMap;F(()=>{a.forEach(e=>{e.remove()})}),a.push(c.on("layerview-create",e=>{l.value=e.layerView}));const d=e=>{l.value&&h(()=>!l.value?.updating).then(e)};o instanceof B&&(m(o.elements),o.elements.on("change",()=>{m(o.elements)}));function m(e){e.filter(r=>r.loadStatus!=="loaded").forEach(r=>{if(u.has(r))return;const s=h(()=>r.loadStatus==="failed");u.set(r,s),s.then(()=>{d(()=>{const n=e.find(y=>y===r);if(e.remove(n),n&&(n[f]??0)<i.retryTimes){const y=V(n,{[f]:(n[f]??0)+1,id:n.id});setTimeout(()=>{e.add(y)},i.retryInterval)}})})})}function V(e,r={}){let s=e;e instanceof E?s=new E({image:e.image,georeference:e.georeference,animationOptions:e.animationOptions,opacity:e.opacity}):e instanceof L&&(s=new L({video:e.video,georeference:e.georeference,opacity:e.opacity}));for(const n in r)s[n]=r[n];return s}return(e,r)=>b(e.$slots,"default")}}),G=M({name:"VaMediaLayer",components:{VaLayerHitEvents:q,MediaTry:z},props:Z,emits:g,setup(t,{emit:i}){const c=W(),o=c.map,l=D(i),a=new C({...t.defaultOptions});return H(()=>{a.source=t.source}),T(o,a,t),O(a,t),v("vaMediaLayer",a),v("vaLayer",a),i("load",{layer:a,view:c}),{hitEmits:l}}});function J(t,i,c,o,l,a){const u=_("VaLayerHitEvents"),d=_("MediaTry");return R(),j(A,null,[w(u,U(t.hitEmits),null,16),b(t.$slots,"default"),w(d,{"retry-times":t.retryTimes,"retry-interval":t.retryInterval},null,8,["retry-times","retry-interval"])],64)}const p=I(G,[["render",J]]);p.install=t=>{t.component(p.name||"VaMediaLayer",p)};export{p as V,ee as c,g as e,P as u};
