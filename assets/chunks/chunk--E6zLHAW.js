import{u as b}from"./chunk-oihAJXyJ.js";import{u as g}from"./chunk-VWaWC7_I.js";import{gZ as h,U as k,lF as v,gV as C,gW as L,lH as S,hc as T}from"./chunk-fHrNL0KE.js";import{s as U}from"./chunk-B3AFDltd.js";import{c as H}from"./chunk-I0Ze1Lq5.js";import{i as I}from"./chunk-I0yzb-TT.js";const M={extras:{type:Array,default:()=>[]},createQueryParameters:{type:Function,default:void 0}},O={click:e=>e},V=h({name:"VaWmsLayerOnClick",props:M,emits:O,setup(e,{emit:i}){const t=b(),s=g(),l=t[U],m=H(l),r=new m("click",async u=>{const{event:n}=u,d=s.sublayers.filter(a=>a.visible&&a.queryable&&a.name).map(({name:a})=>a);d.push(...e.extras);const o=d.join(),{xmin:p,ymin:f,xmax:x,ymax:E,spatialReference:{wkid:$}}=t.extent,R=`${p},${f},${x},${E}`,_=`EPSG:${$}`;let y;o&&(y=await k(s.featureInfoUrl,{query:{SERVICE:"WMS",LAYERS:o,QUERY_LAYERS:o,REQUEST:"GetFeatureInfo",INFO_FORMAT:"application/json",FEATURE_COUNT:5,BBOX:R,CRS:_,WIDTH:t.width,HEIGHT:t.height,I:Math.round(n.x),J:Math.round(n.y),...I(e.createQueryParameters)?e.createQueryParameters(n):{}}})),i("click",{...u,requestResponse:y})});return r.add(),v(()=>{r.remove()}),C(()=>{r.remove()}),L(()=>{r.add()}),{}}});function W(e,i,t,s,l,m){return T(e.$slots,"default")}const c=S(V,[["render",W]]);c.install=e=>{e.component(c.name||"VaWmsLayerOnClick",c)};export{c as V};
