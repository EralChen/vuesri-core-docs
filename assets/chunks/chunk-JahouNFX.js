import{p as $,a as T,u as O}from"./chunk-X1l1T6Lo.js";import{gT as k,nr as N,gZ as M,he as S,lC as H,bL as h,hc as b,gU as I,lz as v,lE as R,h8 as _,h0 as j,h9 as C,h6 as w,oG as U,hb as B}from"./chunk-r79-UitW.js";import{V as F,b as E,a as L,c as W}from"./chunk-BrKYdqT0.js";import{u as q}from"./chunk-QlMQA5MY.js";import{_ as z,c as A}from"./chunk-XNej7aTS.js";function G(){const t=k("vaMediaLayer");if(!t)throw new Error("The component which use useMediaLayer() must be in a MediaLayer component");return t}const P={...$,defaultOptions:{type:Object,default:()=>({})},source:{type:Object,required:!0,default:()=>({})},retryTimes:{type:Number,default:5},retryInterval:{type:Number,default:1e3}},g={load:t=>t,click:t=>t,pointerMove:t=>t},ee=N(g),f="__va_media_layer_retries",Z=M({__name:"media-try",props:{retryTimes:{type:Number,default:5},retryInterval:{type:Number,default:1e3}},setup(t){const i=t,c=G(),o=c.source,l=S(),a=[],u=new WeakMap;H(()=>{a.forEach(e=>{e.remove()})}),a.push(c.on("layerview-create",e=>{l.value=e.layerView}));const d=e=>{l.value&&h(()=>!l.value?.updating).then(e)};o instanceof F&&(m(o.elements),o.elements.on("change",()=>{m(o.elements)}));function m(e){e.filter(r=>r.loadStatus!=="loaded").forEach(r=>{if(u.has(r))return;const s=h(()=>r.loadStatus==="failed");u.set(r,s),s.then(()=>{d(()=>{const n=e.find(y=>y===r);if(e.remove(n),n&&(n[f]??0)<i.retryTimes){const y=V(n,{[f]:(n[f]??0)+1,id:n.id});setTimeout(()=>{e.add(y)},i.retryInterval)}})})})}function V(e,r={}){let s=e;e instanceof E?s=new E({image:e.image,georeference:e.georeference,animationOptions:e.animationOptions,opacity:e.opacity}):e instanceof L&&(s=new L({video:e.video,georeference:e.georeference,opacity:e.opacity}));for(const n in r)s[n]=r[n];return s}return(e,r)=>b(e.$slots,"default")}}),D=M({name:"VaMediaLayer",components:{VaLayerHitEvents:z,MediaTry:Z},props:P,emits:g,setup(t,{emit:i}){const c=q(),o=c.map,l=A(i),a=new W({...t.defaultOptions});return I(()=>{a.source=t.source}),T(o,a,t),O(a,t),v("vaMediaLayer",a),v("vaLayer",a),i("load",{layer:a,view:c}),{hitEmits:l}}});function J(t,i,c,o,l,a){const u=_("VaLayerHitEvents"),d=_("MediaTry");return j(),C(B,null,[w(u,U(t.hitEmits),null,16),b(t.$slots,"default"),w(d,{"retry-times":t.retryTimes,"retry-interval":t.retryInterval},null,8,["retry-times","retry-interval"])],64)}const p=R(D,[["render",J]]);p.install=t=>{t.component(p.name||"VaMediaLayer",p)};export{p as V,ee as c,g as e,G as u};
