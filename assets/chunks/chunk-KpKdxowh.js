import{br as g,oS as y,a1 as S,gX as b,gZ as w,lB as f,gT as d,ll as L}from"./chunk-Id6bT2Sz.js";import{b as u,c as l,a as h,s as T}from"./chunk-B3AFDltd.js";import{u as E}from"./chunk-4YICMpBk.js";const M=(t,e)=>!(e.maxScale&&t<e.maxScale||e.minScale&&t>=e.minScale);function j(t,e,n=10){const r={xmin:e.x-n,ymin:e.y-n,xmax:e.x+n,ymax:e.y+n},o={x:r.xmin,y:r.ymin},a={x:r.xmax,y:r.ymax},i=t.toMap(o),s=t.toMap(a);return new g({xmin:i.x,ymin:s.y,xmax:s.x,ymax:i.y,spatialReference:t.spatialReference})}const v=t=>{if(!t.length)throw new Error("graphics is empty");return y(t.map(n=>n.geometry)).extent},H=t=>{switch(t.type){case"point":return[[t]];case"polyline":const n=t;return n.paths.map((s,c)=>s.map((p,m)=>n.getPoint(c,m)));case"polygon":const r=t;return r.rings.map((s,c)=>s.map((p,m)=>r.getPoint(c,m)));case"multipoint":const o=t;return[o.points.map((s,c)=>o.getPoint(c))];case"extent":const a=t,i=S.fromExtent(a);return H(i);case"mesh":throw new Error("mesh geometry is not supported");default:throw new Error("geometry type is not supported")}},F={maxScale:{type:Number,default:0},minScale:{type:Number,default:0},cursor:{type:String,default:""},title:{type:String,default:""},visible:{type:Boolean,default:!0},opacity:{type:Number,default:1},index:{type:Number,default:void 0},orphan:{type:Boolean,default:!1}},O=t=>class extends b{constructor(n,r){super(),this.name=n,this.handler=r}add(){t.on(this.name,this.handler),this.removeHandler=()=>t.off(this.name,this.handler)}};function P(t,e,n){const r=()=>t instanceof L?t.layers:t;if(n.orphan)return;e[u]=n.index,e[l]=n.indexTopping,t.add(e);const o=()=>{const a=r();B(a).forEach((s,c)=>{setTimeout(()=>{t.reorder(s,c)})})};e.when(()=>{o()}),typeof n.index=="number"&&o(),w(()=>[n.index,n.indexTopping],([a,i])=>{typeof a=="number"&&(e[u]=a,e[l]=i,o())}),f(()=>{t.remove(e)})}function A(t,e){E(t,e),d(()=>{t.title=e.title}),d(()=>{t[h]=e.cursor}),d(()=>{t.opacity=e.opacity})}function V(t,e){A(t,e),d(()=>{t[h]=e.cursor}),d(()=>{t.title=e.title}),d(()=>{t.maxScale=e.maxScale}),d(()=>{t.minScale=e.minScale}),d(()=>{t.opacity=e.opacity})}function C(t,e,n){const r=t[T];if(!r)throw new Error("mitter is not defined");const o=O(r),a=new o("watch:scale",([i])=>{const s=M(i,{maxScale:e.maxScale,minScale:e.minScale});n(s)});a.add(),f(()=>{a.remove()})}function B(t){const e=new x,n=new x;return t.forEach(r=>{const o=r[u];r[l]?n.add(r,o):e.add(r,o)}),[...e.toArray(),...n.toArray()]}class x{constructor(){this.record={}}add(e,n){if(typeof n=="number"){let r=this.record[n];for(;r;)n++,r=this.record[n];this.record[n]=e}else this.record[this.getMaxIndex()+1]=e}getMaxIndex(){const e=Object.keys(this.record);return e.length?Math.max(...e.map(Number)):0}toArray(){return Object.values(this.record)}}export{P as a,A as b,O as c,C as d,v as e,H as f,j as g,M as i,F as p,V as u};
