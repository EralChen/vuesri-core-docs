import{V as P}from"./chunk-v0lT8rQM.js";import{V as U}from"./chunk-MnHm3upY.js";import{V as W}from"./chunk-Gt32dAh7.js";import{R as A}from"./chunk-KpbMssn-.js";import{V as J}from"./chunk-FsgSXnn4.js";import{s as b,qc as l,qd as j,qe as x,qf as k,qg as F,qh as M,qi as Q,qj as Y,qk as z,ql as f,a5 as q,qm as H,qn as K,qo as X,qp as $,qq as Z,qr as ee,gY as ae,hd as I,h7 as te,g$ as re,h0 as ne,h3 as h,h4 as D,h5 as y,h9 as se,h1 as w,C as ie,bc as oe}from"./chunk-nmd5K2Af.js";import"./chunk-sFsCJIsO.js";import"./chunk-_oFyxSRx.js";import"./chunk-B3AFDltd.js";import"./chunk-2Nnh7Nz_.js";import"./chunk-SsoqVI4I.js";import"./chunk-ljfhnYgQ.js";import"./chunk-N3ZHh-oN.js";import"./chunk-IivQlB-q.js";import"./chunk-ESmddae3.js";import"./chunk-6F8PGj_N.js";import"./chunk-QdT98bGi.js";import"./chunk-OPsix7RJ.js";import"./chunk-SrPYhnCK.js";import"./chunk-YEz4U7Qa.js";import"./chunk-rOF-vNB8.js";import"./chunk-vBrfeuUR.js";const le=Y;async function me(a){if(!a?.layer||!a.view)throw new b("heatmap-statistics:missing-parameters","'layer' and 'view' parameters are required");const e=[l.CSVLayer,l.FeatureLayer,l.GeoJSONLayer,l.OGCFeatureLayer,l.OrientedImageryLayer,l.WFSLayer],{layer:r,...s}=a,n=j(r,e);if(!n)throw new b("heatmap-statistics:invalid-parameters","'layer' must be one of these types: "+x(e).join(", "));const t={layerAdapter:n,...s};t.radius=t.radius==null?t.blurRadius==null?18:k(t.blurRadius):t.radius;const u=t.signal!=null?{signal:t.signal}:null;await n.load(u);const p=t.field,o=p?n.getField(p):null,i=await F({field:p}),m=M(n,i,"heatmap-statistics:invalid-parameters");if(m)throw m;if(o){const c=Q(n,o,"heatmap-statistics:invalid-parameters",le);if(c)throw c}return t}async function ce(a){const{layerAdapter:e,...r}=await me(a);return e.heatmapStatistics(r)}const _=.01;async function ue(a){if(!a?.layer||!a.view)throw new b("heatmap-renderer:missing-parameters","'layer' and 'view' parameters are required");const e={...a,layer:a.layer,view:a.view};e.radius??=e.blurRadius==null?18:k(e.blurRadius),e.minRatio??=.01,e.maxRatio??=1,e.fadeRatio??=.2,e.fadeToTransparent??=!0;const r=[l.CSVLayer,l.FeatureLayer,l.GeoJSONLayer,l.OGCFeatureLayer,l.OrientedImageryLayer,l.StreamLayer,l.WFSLayer],s=j(e.layer,r);if(!s)throw new b("heatmap-renderer:invalid-parameters","'layer' must be one of these types: "+x(r).join(", "));e.layer=s;const n=e.signal!=null?{signal:e.signal}:null;await s.load(n);const t=await F({field:e.field}),u=z(s,t,"heatmap-renderer:invalid-parameters");if(u)throw u;return e}async function pe(a){let e=a.scheme,r=null,s=null;const n=await Z(a.basemap,a.view);if(r=n.basemapId!=null?n.basemapId:null,s=n.basemapTheme!=null?n.basemapTheme:null,e)return{scheme:$(e),basemapId:r,basemapTheme:s};const t=ee({basemapTheme:s});return t&&(e=t.primaryScheme,r=t.basemapId,s=t.basemapTheme),{scheme:e,basemapId:r,basemapTheme:s}}async function de(a,e){const{field:r,basemap:s,radius:n,fadeToTransparent:t,heatmapScheme:u,view:p}=e,{scheme:o,basemapId:i,basemapTheme:m}=await pe({basemap:s,scheme:u,view:p}),c=o.colors,T=c.length,R=a.min==null,C=R?[0,.04]:[a.min,a.max];let L;const V=e.fadeRatio??0,O=e.maxRatio??0,g=e.minRatio??0,E=(O-g)/(T-1),d=c[0],S=t?g:_,v=[new f({ratio:0,color:new q([d.r,d.g,d.b,0])}),new f({ratio:_,color:new q([d.r,d.g,d.b,0])}),new f({ratio:S,color:new q([d.r,d.g,d.b,S])})];return H(c,T).forEach((B,N)=>{const G=g+E*N;v.push(new f({ratio:G,color:B}))}),t&&(he(v,V),L=new K({fadeRatio:V})),{renderer:new X({authoringInfo:L,radius:n,colorStops:v,field:r,minDensity:C[0],maxDensity:C[1]}),statistics:a,defaultValuesUsed:R,scheme:$(o),basemapId:i,basemapTheme:m}}function he(a,e){const r=10*(1-e)+1,s=a.length-3,n=a[2].color.a;a.forEach((t,u)=>{if(u<=2)return;const{color:p}=t,o=(u-3)/s;p.a=e===0?1:Math.min(Math.max(o*r+o+n,n),1)})}async function ye(a){const e=await ue(a);return de(e.statistics??await ce({layer:e.layer,field:e.field,radius:e.radius,view:e.view,signal:e.signal}),e)}const fe=new A({baseURL:"/data"}),we=()=>fe.request({method:"GET",url:"/point1.json"}).then(a=>a[0]),Ge=ae({__name:"index",setup(a){const e=I(),r=I([]),s=()=>{we().then(o=>{r.value=o.centerPoints.map((i,m)=>new ie({geometry:new oe({longitude:i.centerPoint[0],latitude:i.centerPoint[1]}),attributes:{probabilityDensity:i.probabilityDensity,ranking:i.ranking,ObjectID:m}}))})};s();const n=o=>{const{result:i}=o;i&&console.log(i)},t=async o=>{const i=o.layer,m=o.view;await i.when(),m.goTo(r.value);const c=await ye({layer:i,view:m,field:"probabilityDensity"});console.log(c),e.value=c.renderer},u=()=>{s()},p=()=>{r.value=[]};return(o,i)=>{const m=te("ElButton");return re(),ne(w(U),null,{before:h(()=>[se("p",null,[y(m,{onClick:i[0]||(i[0]=c=>u())},{default:h(()=>[D("getTestData")]),_:1}),y(m,{onClick:p},{default:h(()=>[D("清空")]),_:1})])]),default:h(()=>[y(w(W),{type:"img_w",spatialReference:{wkid:3857}}),y(w(J),null,{default:h(({spatialReference:c})=>[y(w(P),{spatialReference:c,renderer:e.value,source:r.value,fields:[{name:"ObjectID",type:"oid"},{name:"probabilityDensity",type:"double"},{name:"ranking",type:"double"}],"geometry-type":"point","object-id-field":"ObjectID",cursor:"pointer",onClick:n,onChange:t},null,8,["spatialReference","renderer","source"])]),_:1})]),_:1})}}});export{Ge as default};
