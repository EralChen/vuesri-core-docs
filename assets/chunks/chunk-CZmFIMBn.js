import{p as b,a as T,u as O}from"./chunk-35-ZZMVr.js";import{gJ as k,pt as H,gO as M,h3 as N,lC as R,bH as v,h1 as L,gK as S,lz as h,lE as j,gZ as _,gR as I,g_ as C,gW as g,qX as W,h0 as q}from"./chunk-CMhy9c9G.js";import{V as B,_ as F}from"./chunk-895G59h-.js";import{E as w,j as E}from"./chunk-CmFK1iGu.js";import{u as U}from"./chunk-Dc5RCiI0.js";import{_ as z,c as A}from"./chunk-B-RuJrXv.js";function D(){const e=k("vaMediaLayer");if(!e)throw new Error("The component which use useMediaLayer() must be in a MediaLayer component");return e}const J={...b,defaultOptions:{type:Object,default:()=>({})},source:{type:Object,required:!0,default:()=>({})},retryTimes:{type:Number,default:5},retryInterval:{type:Number,default:1e3}},V={load:e=>e,click:e=>e,pointerMove:e=>e},te=H(V),f="__va_media_layer_retries",K=M({__name:"media-try",props:{retryTimes:{type:Number,default:5},retryInterval:{type:Number,default:1e3}},setup(e){const i=e,c=D(),o=c.source,l=N(),r=[],u=new WeakMap;R(()=>{r.forEach(t=>{t.remove()})}),r.push(c.on("layerview-create",t=>{l.value=t.layerView}));const y=t=>{l.value&&v(()=>!l.value?.updating).then(t)};o instanceof B&&(m(o.elements),o.elements.on("change",()=>{m(o.elements)}));function m(t){t.filter(a=>a.loadStatus!=="loaded").forEach(a=>{if(u.has(a))return;const s=v(()=>a.loadStatus==="failed");u.set(a,s),s.then(()=>{y(()=>{const n=t.find(d=>d===a);if(t.remove(n),n&&(n[f]??0)<i.retryTimes){const d=$(n,{[f]:(n[f]??0)+1,image:typeof a.image=="string"?a.image+"?t="+Date.now():a.image,id:n.id});setTimeout(()=>{y(()=>{t.add(d)})},i.retryInterval)}})})})}function $(t,a={}){let s=t;t instanceof w?s=new w({image:t.image,georeference:t.georeference,opacity:t.opacity}):t instanceof E&&(s=new E({video:t.video,georeference:t.georeference,opacity:t.opacity}));for(const n in a)s[n]=a[n];return s}return(t,a)=>L(t.$slots,"default")}}),P=M({name:"VaMediaLayer",components:{VaLayerHitEvents:z,MediaTry:K},props:J,emits:V,setup(e,{emit:i}){const c=U(),o=c.map,l=A(i),r=new F({...e.defaultOptions});return S(()=>{r.source=e.source}),T(o,r,e),O(r,e),h("vaMediaLayer",r),h("vaLayer",r),i("load",{layer:r,view:c}),{hitEmits:l}}});function X(e,i,c,o,l,r){const u=_("VaLayerHitEvents"),y=_("MediaTry");return I(),C(q,null,[g(u,W(e.hitEmits),null,16),L(e.$slots,"default"),g(y,{"retry-times":e.retryTimes,"retry-interval":e.retryInterval},null,8,["retry-times","retry-interval"])],64)}const p=j(P,[["render",X]]);p.install=e=>{e.component(p.name||"VaMediaLayer",p)};export{p as V,te as c,V as e,D as u};
