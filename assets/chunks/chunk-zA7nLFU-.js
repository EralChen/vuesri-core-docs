import{V as z}from"./chunk-w3qa_8IS.js";import{gZ as R,gU as V,lA as y,lF as G,h8 as B,h0 as C,h9 as E,h6 as F,oF as k,hc as I,hb as O,b$ as l,a5 as w,c0 as c,ab as v,jX as L,ci as M,bR as P,C as g,cJ as T,a2 as j,lm as A,he as _,ar as H,hZ as D,a6 as N,h1 as b,h4 as Z,h2 as S,hk as U}from"./chunk-xMPjLCrx.js";import{p as q,a as J}from"./chunk-rQi2mmfE.js";import{_ as W,c as X}from"./chunk-gzqjvZQi.js";import{u as K}from"./chunk-QHcv4ANa.js";import"./chunk-B3AFDltd.js";import"./chunk-xWC1_lmp.js";import"./chunk-J9RASU-T.js";import"./chunk-Qgrzwe6s.js";import"./chunk-tmZ5iYy4.js";import"./chunk-X6bIPsmo.js";const Q={...q,defaultOptions:{type:Object,default:()=>({})},source:{type:Array,default:()=>[]}},Y={click:e=>e,pointerMove:e=>e,load:e=>e},ee=R({name:"VaCluster3dLayer",components:{VaLayerHitEvents:W},props:Q,emits:Y,setup(e,{emit:t}){const n=K(),s=n.map,r=X(t),o=new p({...e.defaultOptions});return V(()=>{o.source=e.source}),J(s,o,e),y("vaLayer",o),y("vaGraphicsLayer",o),y("vaCluster3dLayer",o),t("load",{view:n,layer:o}),{hitEmits:r}}});function te(e,t,n,s,r,o){const a=B("VaLayerHitEvents");return C(),E(O,null,[F(a,k(e.hitEmits),null,16),I(e.$slots,"default")],64)}const m=G(ee,[["render",te]]);new l({size:14,color:new w([0,0,0,.5]),outline:new c({color:new w([255,255,255,.5]),width:1})});new v({color:new w([255,255,255]),font:{size:10,family:"arial"},yoffset:-3});new v({color:new w([255,255,255]),font:{size:6,family:"arial"},yoffset:-2});const h=new L({defaultSymbol:new l({size:6,color:"#FF0000"}),field:"clusterCount"}),se=new l({size:22,outline:new c({color:[221,159,34,.8]}),color:[255,204,102,.8]}),re=new l({size:24,outline:new c({color:[82,163,204,.8]}),color:[102,204,255,.8]}),oe=new l({size:28,outline:new c({color:[41,163,41,.8]}),color:[51,204,51,.8]}),ne=new l({size:32,outline:new c({color:[200,52,59,.8]}),color:[250,65,74,.8]});h.addClassBreakInfo(0,19,se);h.addClassBreakInfo(20,150,re);h.addClassBreakInfo(151,1e3,oe);h.addClassBreakInfo(1001,1/0,ne);var ie=Object.defineProperty,ae=Object.getOwnPropertyDescriptor,le=(e,t,n,s)=>{for(var r=s>1?void 0:s?ae(t,n):t,o=e.length-1,a;o>=0;o--)(a=e[o])&&(r=(s?a(t,n,r):a(r))||r);return s&&r&&ie(t,n,r),r};let p=class extends M{constructor(e){super(e),this.view=null,this.handles=[],this.gridClusters=[],this.source=[],this.clusterRatio=75,this.clusterToScale=5e6,this.clusterMinCount=2,this.clusterRenderer=h;const t=this.on("layerview-create",n=>{this.onLayerviewCreate(n)});this.handles.push(t),this.source=e?.source||[],e?.clusterRatio&&(this.clusterRatio=e.clusterRatio),e?.clusterToScale&&(this.clusterToScale=e.clusterToScale),e?.clusterMinCount&&(this.clusterMinCount=e.clusterMinCount),e?.clusterRenderer&&(this.clusterRenderer=e.clusterRenderer)}onLayerviewCreate(e){if(!this.view){this.view=e.layerView.view;const t=this.view.watch("stationary",n=>{n&&this.draw()});this.handles.push(t),this.draw()}}draw(){if(!(!this.view||!this.source.length||!this.view.extent)){this.clear(),this.isClustered&&this.createClusterGrid();for(const e of this.source){const t=this.getPointFromGraphic(e);if(this.view.extent.expand(1.2).contains(t))if(this.isClustered)for(const s of this.gridClusters)s.extent.contains(t)&&(s.points.push(t),s.singles.push(e),s.x=s.points.reduce((r,o)=>r+o.x,0)/s.points.length,s.y=s.points.reduce((r,o)=>r+o.y,0)/s.points.length,s.clusterCount++);else this.createSingle(e)}if(this.isClustered)for(let e=0;e<this.gridClusters.length;e++){const t=this.gridClusters[e];if(t.clusterCount>=this.clusterMinCount)this.createCluster(t);else for(const n of t.singles)this.createSingle(n)}}}async createCluster(e){const t=new ce,n=new P({x:e.x,y:e.y,spatialReference:this.view?.spatialReference}),s={x:e.x,y:e.y,clusterCount:e.clusterCount,isCluster:!0,gridCluster:e};t.clusterGraphic=new g({geometry:n,attributes:s}),t.textGraphic=new g({geometry:n,attributes:s,symbol:new v({text:e.clusterCount.toString(),color:"#fff",font:{size:12},verticalAlignment:"middle"})});const r=await this.clusterRenderer.getClassBreakInfo(t.clusterGraphic);r&&(t.clusterGraphic.symbol=r.symbol),this.add(t.clusterGraphic),this.add(t.textGraphic)}createSingle(e){this.add(e)}createClusterGrid(){if(!this.view)throw new Error("view is not defined");const e=Math.round(this.view.width/this.clusterRatio),t=Math.round(this.view.height/this.clusterRatio),n=(this.view.extent.xmax-this.view.extent.xmin)/e,s=(this.view.extent.ymax-this.view.extent.ymin)/t;this.gridClusters=[];let r,o,a,f;for(let i=0;i<e;i++){r=this.view.extent.xmin+n*i,o=r+n;for(let u=0;u<t;u++){a=this.view.extent.ymin+s*u,f=a+s;const $=new T({xmin:r,ymin:a,xmax:o,ymax:f,spatialReference:this.view.spatialReference}),x=new ue;x.extent=$,this.gridClusters.push(x)}}}clear(){this.removeAll()}get isClustered(){return this.view?this.view.scale>this.clusterToScale:!1}getPointFromGraphic(e){return e.geometry.type==="polygon"?e.geometry.centroid:e.geometry.type==="polyline"?e.geometry.extent.center:e.geometry}dispose(){this.clear(),this.handles.forEach(e=>e.remove())}};p=le([j("vuesri.core.Cluster3DLayer")],p);class ce{}class ue{constructor(){this.clusterCount=0,this.points=[],this.singles=[],this.x=0,this.y=0}}m.install=e=>{e.component(m.name||"VaCluster3dLayer",m)};const d=new L({defaultSymbol:new l({size:6,color:"#FF0000"}),field:"clusterCount"}),he=new l({size:22,outline:new c({color:[221,159,34,.8]}),color:[255,204,102,.8]}),de=new l({size:24,outline:new c({color:[82,163,204,.8]}),color:[102,204,255,.8]}),fe=new l({size:28,outline:new c({color:[41,163,41,.8]}),color:[51,204,51,.8]}),me=new l({size:32,outline:new c({color:[200,52,59,.8]}),color:[250,65,74,.8]});d.addClassBreakInfo(0,5,he);d.addClassBreakInfo(5,10,de);d.addClassBreakInfo(10,20,fe);d.addClassBreakInfo(20,1/0,me);const we="https://services.arcgis.com/V6ZHFr6zdgNZuVG0/arcgis/rest/services/US_National_Parks_Annual_Visitation/FeatureServer/0",$e=R({__name:"basic",setup(e){const n={map:new A({basemap:"arcgis-imagery"})},s=_([]),r=_([]),o=new H;o.returnGeometry=!0,o.outFields=["*"],o.where="1=1",D(we,o).then(i=>{i.features.forEach(u=>{u.symbol=new N({symbolLayers:[{type:"icon",size:16,material:{color:"rgba(0,191,255,0.8)"}}]})}),s.value=i.features,r.value=i.fields});const a={clusterRenderer:d,clusterRatio:100,clusterToScale:2e6,clusterMinCount:2},f=async i=>{const u=i.view;console.log("layer loaded",i.layer),await i.layer.when(),u.goTo(i.layer.fullExtent)};return(i,u)=>(C(),b(S(z),{"default-options":n},{default:Z(()=>[s.value.length?(C(),b(S(m),{key:0,source:s.value,"default-options":a,onLoad:f},null,8,["source"])):U("",!0)]),_:1}))}});export{$e as default};
