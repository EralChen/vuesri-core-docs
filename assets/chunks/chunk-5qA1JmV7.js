import{hv as w,hw as P,hx as T,hy as q,s as H,a7 as j,hz as E,hA as U,aQ as V,hB as z}from"./chunk-YzRi88Dj.js";import{t as C,e as W,d as D,l as I}from"./chunk-BKMATugk.js";import"./chunk-ByM7454y.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */const O="picture-fill",Q="picture-marker",G="simple-fill",J="simple-line",K="simple-marker",N="text",X="Aa",Y=C.size,L=C.maxSize,_=C.maxOutlineSize,F=C.lineWidth,A=225,$=document.createElement("canvas");function R(e,t){const i=$.getContext("2d"),a=[];t&&(t.weight&&a.push(t.weight),t.size&&a.push(t.size+"px"),t.family&&a.push(t.family)),i.font=a.join(" ");const{width:r,actualBoundingBoxLeft:s,actualBoundingBoxRight:d,actualBoundingBoxAscent:h,actualBoundingBoxDescent:c}=i.measureText(e);return{width:Math.ceil(Math.max(r,s+d)),height:Math.ceil(h+c),x:Math.floor(s),y:Math.floor((h-c)/2)}}function x(e){const t=e?.size;return{width:t!=null&&typeof t=="object"&&"width"in t?w(t.width):null,height:t!=null&&typeof t=="object"&&"height"in t?w(t.height):null}}async function tt(e,t){const i=t.fill,a=e.color;if(i?.type==="pattern"&&a&&e.type!==O){const r=await U(i.src,a.toCss(!0));i.src=r,t.fill=i}}async function et(e,t,i,a){if(!("font"in e)||!e.font||t.shape.type!=="text")return;try{await V(e.font)}catch{}const{width:r,height:s}=x(a);if(!/[\uE600-\uE6FF]/.test(t.shape.text)){const{width:d,height:h,x:c,y:p}=R(t.shape.text,{weight:t.font?.weight,size:t.font?.size,family:t.font?.family});i[0]=r??d,i[1]=s??h,t.shape.x=c,t.shape.y=p;const f=a?.rotation!=null?a.rotation:"angle"in e?e.angle:null;if(f){const o=f*(Math.PI/180),n=Math.abs(Math.sin(o)),b=Math.abs(Math.cos(o));i[1]=i[0]*n+i[1]*b}}}function at(e,t,i,a,r){if(e.haloColor!=null&&e.haloSize!=null){r.masking??=i.map(()=>[]);const s=w(e.haloSize);a[0]+=s,a[1]+=s,i.unshift([{...t,fill:null,stroke:{color:e.haloColor,width:2*s,join:"round",cap:"round"}}]),r.masking.unshift([{shape:{type:"rect",x:0,y:0,width:a[0]+2*z,height:a[1]+2*z},fill:[255,255,255],stroke:null},{...t,fill:[0,0,0,0],stroke:null}])}e.backgroundColor==null&&e.borderLineColor==null||(a[0]+=2*z,a[1]+=2*z,i.unshift([{shape:{type:"rect",x:0,y:0,width:a[0],height:a[1]},fill:e.backgroundColor,stroke:{color:e.borderLineColor,width:w(e.borderLineSize)}}]),r.masking?.unshift([]))}function Z(e,t){return e>t?"dark":"light"}function it(e,t){const i=typeof t?.size=="number"?t?.size:null,a=i!=null?w(i):null,r=t?.maxSize!=null?w(t.maxSize):null,s=t?.rotation!=null?t.rotation:"angle"in e?e.angle:null,d=P(e);let h=T(e);ot(e,245)!=="dark"||t?.ignoreWhiteSymbols||(h={width:.75,...h,color:"#bdc3c7"});const c={shape:null,fill:d,stroke:h,offset:[0,0]};h?.width&&(h.width=Math.min(h.width,_));const p=h?.width||0;let f=t?.size!=null&&(t?.scale==null||t?.scale),o=0,n=0,b=!1;switch(e.type){case K:{const m=e.style,{width:u,height:l}=x(t),v=u===l&&u!=null?u:a??Math.min(w(e.size),r||L);switch(o=v,n=v,m){case"circle":c.shape={type:"circle",cx:0,cy:0,r:.5*v},f||(o+=p,n+=p);break;case"cross":c.shape={type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[o,.5*n]},{command:"M",values:[.5*o,0]},{command:"L",values:[.5*o,n]}]};break;case"diamond":c.shape={type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,.5*n]},{command:"L",values:[.5*o,n]},{command:"Z",values:[]}]},f||(o+=p,n+=p);break;case"square":c.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,0]},{command:"L",values:[o,n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]},f||(o+=p,n+=p),s&&(b=!0);break;case"triangle":c.shape={type:"path",path:[{command:"M",values:[.5*o,0]},{command:"L",values:[o,n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]},f||(o+=p,n+=p),s&&(b=!0);break;case"x":c.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,n]},{command:"M",values:[o,0]},{command:"L",values:[0,n]}]},s&&(b=!0);break;case"path":c.shape={type:"path",path:e.path||""},f||(o+=p,n+=p),s&&(b=!0),f=!0}break}case J:{const{width:m,height:u}=x(t),l=q(h).reduce((B,M)=>B+M,0),v=l&&Math.ceil(F/l),y=u??a??p,g=m??(l*v||F);h&&(h.width=y),o=g,n=y,f=!0,c.shape={type:"path",path:[{command:"M",values:[y/2,n/2]},{command:"L",values:[o-y/2,n/2]}]};break}case O:case G:{const m=typeof t?.symbolConfig=="object"&&!!t?.symbolConfig?.isSquareFill,{width:u,height:l}=x(t);o=!m&&u!==l||u==null?a??Y:u,n=!m&&u!==l||l==null?o:l,f||(o+=p,n+=p),f=!0,c.shape=m?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,0]},{command:"L",values:[o,n]},{command:"L",values:[0,n]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:W.fill[0];break}case Q:{const m=Math.min(w(e.width),r||L),u=Math.min(w(e.height),r||L),{width:l,height:v}=x(t),y=l===v&&l!=null?l:a??Math.max(m,u),g=m/u;o=g<=1?Math.ceil(y*g):y,n=g<=1?y:Math.ceil(y/g),c.shape={type:"image",x:-Math.round(o/2),y:-Math.round(n/2),width:o,height:n,src:e.url||""},s&&(b=!0);break}case N:{const m=e,u=t?.overrideText||m.text||X,l=m.font,{width:v,height:y}=x(t),g=y??a??Math.min(w(l.size),r||L),{width:B,height:M}=R(u,{weight:l.weight,size:g,family:l.family}),k=/[\uE600-\uE6FF]/.test(u);o=v??(k?g:B),n=k?g:M;let S=.5*(k?g:M);k&&(S+=5),c.shape={type:"text",text:u,x:m.xoffset||0,y:m.yoffset||S,align:"middle",alignBaseline:m.verticalAlignment,decoration:l&&l.decoration,rotated:m.rotated,kerning:m.kerning},c.font=l&&{size:g,style:l.style,decoration:l.decoration,weight:l.weight,family:l.family};break}}return{shapeDescriptor:c,size:[o,n],renderOptions:{node:t?.node,scale:f,opacity:t?.opacity,rotation:s,useRotationSize:b,effectView:t?.effectView,ariaLabel:t?.ariaLabel}}}async function Ht(e,t){const{shapeDescriptor:i,size:a,renderOptions:r}=it(e,t);if(!i.shape)throw new H("symbolPreview: renderPreviewHTML2D","symbol not supported.");await tt(e,i),await et(e,i,a,t);const s=[[i]];if(typeof t?.symbolConfig=="object"&&t?.symbolConfig?.applyColorModulation){const d=.6*a[0];s.unshift([{...i,offset:[-d,0],fill:D(i.fill,-.3)}]),s.push([{...i,offset:[d,0],fill:D(i.fill,.3)}]),a[0]+=2*d,r.scale=!1}return e.type==="text"&&at(e,i,s,a,r),I(s,a,r)}function ot(e,t=A){const i=P(e),a=T(e),r=!i||"type"in i?null:new j(i),s=a?.color?new j(a?.color):null,d=r?Z(E(r),t):null,h=s?Z(E(s),t):null;return h?d?d===h?d:t>=A?"light":"dark":h:d}export{ot as getContrastingBackgroundTheme,it as getRenderSymbolParameters,Ht as previewSymbol2D};
