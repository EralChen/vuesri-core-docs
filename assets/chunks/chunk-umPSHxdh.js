import{p as $,c as E,h as I}from"./chunk-P-mZngti.js";import{U as b,a1 as N,gZ as k,lD as T,gV as _,gW as z,hc as S,he as h,lu as P,g_ as D,lr as M,lF as B,h8 as g,h0 as f,h1 as y,h4 as d,hk as v,nu as q,h7 as F,h2 as u,h6 as V}from"./chunk-5cgByRBI.js";import{V as O}from"./chunk-vGsokStW.js";import{s as Z}from"./chunk-B3AFDltd.js";import{u as A}from"./chunk-AKK1CEJt.js";import"./chunk-Px56PspP.js";import"./chunk-E5BRPeYu.js";import"./chunk-pCqGjxAI.js";import"./chunk-zSey9Ooj.js";import"./chunk-h-6BO8IB.js";import"./chunk-xAN4VzPO.js";import"./chunk-UKZSLdqr.js";import"./chunk-WSF21JF0.js";import{V as U}from"./chunk-yZafP3rf.js";import"./chunk-H62H84bQ.js";import"./chunk-x_uP2gs7.js";import"./chunk-CuAaMpbW.js";import"./chunk-9fCAoXev.js";import{V as Y}from"./chunk-at0AWBwu.js";import"./chunk-ahoVFfdr.js";import"./chunk-vVb9o76x.js";import"./chunk-xrk-kNOH.js";import"./chunk-pwJAAE4U.js";import"./chunk-n27tu1zc.js";import"./chunk-O7qZ5nAO.js";import"./chunk-Ow-0ZicZ.js";import"./chunk-n41jAy5X.js";import"./chunk-puQ8N500.js";import"./chunk-DLXyH4A4.js";import"./chunk-Kr9URs_A.js";import"./chunk-EL967GvW.js";import"./chunk-sPUU7m6j.js";import"./chunk-vI5OQCLh.js";import"./chunk-TdOen-x3.js";import"./chunk-FmJXFfP7.js";import"./chunk-e_xIS2Vw.js";import"./chunk-bCfOp0ta.js";import"./chunk-3EAHv1mu.js";import"./chunk-d0kHfygp.js";import"./chunk-Ysh6IYsX.js";import"./chunk-z09cFCry.js";import"./chunk-tdkwsFTd.js";import{V as G,s as x}from"./chunk-DGzo3AFt.js";import"./chunk-ZKUTSqCA.js";import"./chunk-GGNru00e.js";import"./chunk-_HEdEAnB.js";import"./chunk-fAQUSyrm.js";import"./chunk-JsLoWACQ.js";import"./chunk-oS8TyLWd.js";import"./chunk-a-xr3J5F.js";import"./chunk-egdxQktw.js";import"./chunk-HIFxgyK4.js";import"./chunk-TTXlCCZW.js";import"./chunk-aO_7W1pF.js";import"./chunk-zcGkV3CJ.js";import"./chunk-Hd4L5YxN.js";import"./chunk-wlAG3hwf.js";import"./chunk-AiqscqsX.js";import"./chunk-mnNLVLmE.js";const H={...$,layerName:{type:String,required:!0},spatialReference:{type:Object,default:()=>({wkid:3857})},url:{type:String,required:!0},token:{type:String,default:""},paint:null,queryable:{type:Boolean,default:!1}},J={load:r=>r,click:r=>r};/* @preserve
* @terraformer/arcgis - v2.1.1 - MIT
* Copyright (c) 2012-2022 Environmental Systems Research Institute, Inc.
* Tue Aug 02 2022 14:23:48 GMT-0700 (Pacific Daylight Time)
*/var K=function(e,o){for(var t=0;t<e.length;t++)if(e[t]!==o[t])return!1;return!0},w=function(e){return K(e[0],e[e.length-1])||e.push(e[0]),e},R=function(e){var o=0,t=0,a=e.length,n=e[t],i;for(t;t<a-1;t++)i=e[t+1],o+=(i[0]-n[0])*(i[1]+n[1]),n=i;return o>=0},W=function(e){var o={};for(var t in e)e.hasOwnProperty(t)&&(o[t]=e[t]);return o},C=function(e){var o=[],t=e.slice(0),a=w(t.shift().slice(0));if(a.length>=4){R(a)||a.reverse(),o.push(a);for(var n=0;n<t.length;n++){var i=w(t[n].slice(0));i.length>=4&&(R(i)&&i.reverse(),o.push(i))}}return o},X=function(e){for(var o=[],t=0;t<e.length;t++)for(var a=C(e[t]),n=a.length-1;n>=0;n--){var i=a[n].slice(0);o.push(i)}return o},Q=function r(e,o){o=o||"OBJECTID";var t={wkid:4326},a={},n;switch(e.type){case"Point":a.x=e.coordinates[0],a.y=e.coordinates[1],e.coordinates[2]!=null&&(a.z=e.coordinates[2]),a.spatialReference=t;break;case"MultiPoint":a.points=e.coordinates.slice(0),e.coordinates[0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"LineString":a.paths=[e.coordinates.slice(0)],e.coordinates[0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"MultiLineString":a.paths=e.coordinates.slice(0),e.coordinates[0][0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"Polygon":a.rings=C(e.coordinates.slice(0)),e.coordinates[0][0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"MultiPolygon":a.rings=X(e.coordinates.slice(0)),e.coordinates[0][0][0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"Feature":e.geometry&&(a.geometry=r(e.geometry,o)),a.attributes=e.properties?W(e.properties):{},e.id&&(a.attributes[o]=e.id);break;case"FeatureCollection":for(a=[],n=0;n<e.features.length;n++)a.push(r(e.features[n],o));break;case"GeometryCollection":for(a=[],n=0;n<e.geometries.length;n++)a.push(r(e.geometries[n],o));break}return a};function j(r,e,o){const t=Q(r,e);return o&&(t.spatialReference=o),t}async function ee(r,e){return b(r,{responseType:"json",query:{LAYER:e.LAYER,token:e.token,SERVICE:"mvt"}}).then(o=>{const t=o.data,a=JSON.parse(t.bbox),n=j(a),i=new N(n);return t.bbox=i,t.fullExtent=i.extent,t})}function te(r,e){return b(r,{responseType:"json",headers:{token:e.token},query:{layerName:e.layerName,point:`${e.longitude},${e.latitude}`}}).then(o=>o)}const re=k({__name:"on-click",props:{token:{type:String,default:""},baseUrl:{type:String,default:""},layerName:{type:String,default:""}},emits:{click:null},setup(r,{emit:e}){const o=r,t=e,n=A()[Z],i=E(n),s=new i("click",async c=>{te(o.baseUrl+"/vector/getVectorInfo",{token:o.token,layerName:o.layerName,latitude:c.event.mapPoint.latitude,longitude:c.event.mapPoint.longitude}).then(l=>{t("click",{...c,requestResponse:l})})});return s.add(),T(()=>{s.remove()}),_(()=>{s.remove()}),z(()=>{s.add()}),(c,l)=>S(c.$slots,"default")}}),ae=k({name:"VaSkzzVectorTileLayer",components:{VaVectorTileLayer:O,OnClick:re},props:H,emits:J,setup(r,{emit:e}){const o=I(r,[]),t=h({}),a=P(()=>{const l={layers:[],version:8,sources:{}};if(t.value.id){l.layers=[{...t.value,paint:r.paint}];const p=t.value.source;p&&(l.sources[p]={type:"vector",tiles:new Array(10).fill(0).map((ne,L)=>`${r.url}/mvt?LAYER=${t.value.id}&SRS=${r.spatialReference.wkid||3857}&SERVICE=mvt&x={x}&y={y}&z={z}&token=${r.token}`.replace("t1",`t${L+1}`))})}return l});D(()=>r.layerName,i,{immediate:!0});const n=h();async function i(){return ee(r.url+"/mvtInfo",{LAYER:r.layerName,token:r.token}).then(l=>{t.value={id:l.id,source:l.source,"source-layer":l["source-layer"],type:l.type},n.value=l})}const s=M(()=>{t.value.id,{...r.paint}});return{layerProps:o,style:a,layerSource:t,ready:s,layerLoad:async l=>{const p=l.layer;n.value&&(p.capabilitiesResponse=n.value),e("load",{view:l.view,layer:p})}}}});function oe(r,e,o,t,a,n){const i=g("OnClick"),s=g("VaVectorTileLayer");return r.ready&&r.layerSource.id?(f(),y(s,{key:0,style:q(r.style),onLoad:r.layerLoad},{default:d(()=>[r.queryable?(f(),y(i,{key:0,"base-url":r.url,token:r.token,"layer-name":r.layerName,onClick:e[0]||(e[0]=c=>r.$emit("click",c))},null,8,["base-url","token","layer-name"])):v("",!0),S(r.$slots,"default")]),_:3},8,["style","onLoad"])):v("",!0)}const m=B(ae,[["render",oe]]);m.install=r=>{r.component(m.name||"VaSkzzVectorTileLayer",m)};const ut=k({__name:"basic",setup(r){const e=F({url:"http://192.168.110.151:33334/zz-mapServer/mapServer/layer",layerName:"V20240605-000003-P3",token:"EAD28020541B4DD1A30C3FE257FB8C369563VEMZVK1YXUJT"}),o=[{templateType:"VkfInput",label:"url",prop:"url"},{templateType:"VkfInput",label:"图层名称",prop:"layerName"},{templateType:"VkfInput",label:"token",prop:"token"}],t={"circle-color":"#ff0000"},a=async i=>{const s=i.view;await s.when(),await i.layer.when();const c=i.layer.capabilitiesResponse.fullExtent;s.goTo(c)},n=async i=>{console.log(i.requestResponse?.data,"e.requestResponse.data")};return(i,s)=>(f(),y(u(Y),null,{before:d(()=>[V(u(G),{"form-items":o,data:e,onSetData:s[0]||(s[0]=c=>u(x)(e,c))},null,8,["data"])]),default:d(()=>[V(u(U),{type:"img_w","spatial-reference":{wkid:3857}}),e.layerName?(f(),y(u(m),{key:0,url:e.url,"layer-name":e.layerName,token:e.token,paint:t,queryable:!0,onLoad:a,onClick:n},null,8,["url","layer-name","token"])):v("",!0)]),_:1}))}});export{ut as default};
