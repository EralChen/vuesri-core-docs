import{V as R}from"./chunk-DZ3w8ZOu.js";import{V as O}from"./chunk-C9tqeO9j.js";import{u as S}from"./chunk-mQ0J7OJ8.js";import{gW as $,g$ as I,U as z,lJ as A,gY as U,gZ as b,lL as j,he as H,h2 as B,h3 as F,h6 as E,h7 as l,h4 as s}from"./chunk-YzRi88Dj.js";import{s as N}from"./chunk-DHvBO4SR.js";import{c as P}from"./chunk-BHw4eVQu.js";import{V as q}from"./chunk-BwNtFsQb.js";import"./chunk-B7IxsrlQ.js";import"./chunk-Ch0SDxT-.js";/* empty css              */import"./chunk-BJmFAILw.js";import"./chunk-DlgRifwZ.js";import"./chunk-lA_W8v3a.js";import"./chunk-BkUj7kCJ.js";import"./chunk-CurIDYYZ.js";import"./chunk-CuewZUm5.js";import"./chunk-Clcwg9Qm.js";import"./chunk-CFLxDY7g.js";import"./chunk-ByM7454y.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-BCOlSIf9.js";import"./chunk-c5sFaa6D.js";function D(){const o=$("vaWmtsLayer");if(!o)throw new Error("The component which use useWmtsLayer() must be in a WmtsLayer component");return o}const J={modelValue:{type:Object,default:()=>({})}},X={click:o=>o},Y=I({name:"VaWmtsLayerOnClick",props:J,emits:X,setup(o,{emit:i}){const e=S(),t=D(),r=e[N],u=P(r),a=new u("click",async d=>{const{event:M}=d,c=t.activeLayer;await t.when();const f=M.mapPoint,y=c.id,p=c.tileMatrixSet.tileInfo,L=p.origin,k=e.zoom,n=p.lods.find(C=>C.level===k+1);if(!n)return;const[h,v]=p.size,w=(f.x-L.x)/(n.resolution*h),_=(L.y-f.y)/(n.resolution*v);var V=Math.floor(w),g=Math.floor(_);const W=Math.round((w-V)*h),x=Math.round((_-g)*v);let T;y&&(T=await z(t.url,{query:{SERVICE:"WMTS",LAYER:y,REQUEST:"GetFeatureInfo",VERSION:"1.0.0",INFOFORMAT:"application/json",TILECOL:V,TILEROW:g,TILEMATRIX:n.levelValue,TILEMATRIXSET:c.tileMatrixSet.id,I:W,J:x}}).catch(()=>{})),i("click",{...d,requestResponse:T})});return a.add(),A(()=>{a.remove()}),U(()=>{a.remove()}),b(()=>{a.add()}),{}}});function Z(o,i,e,t,r,u){return H(o.$slots,"default")}const m=j(Y,[["render",Z]]);m.install=o=>{o.component(m.name,m)};const G="http://192.168.110.10:36800/zzserver/gwc/service/wmts",Gt=I({__name:"basic",setup(o){const i=t=>{const r=t.view;console.log("wmtsLayerLoad",t.layer),t.layer.when().then(()=>{t.layer.activeLayer?.fullExtent&&r.goTo(t.layer.activeLayer.fullExtent)})},e=t=>{console.log("layerClick",t)};return(t,r)=>(B(),F(s(R),{"default-options":{zoom:2}},{default:E(()=>[l(s(O),{type:"vec_w",anno:!1,"spatial-reference":{wkid:3857}}),l(s(q),{url:G,title:"testLayer","service-mode":"KVP",onLoad:i},{default:E(()=>[l(s(m),{onClick:e})]),_:1})]),_:1}))}});export{Gt as default};
