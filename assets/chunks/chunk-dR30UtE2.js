import{V as W}from"./chunk-CM_lIypp.js";import{V as P}from"./chunk-DjjaYBlz.js";import{V as U}from"./chunk-B4Rwpdzs.js";import{R as A}from"./chunk-zKPkODU6.js";import{V as J}from"./chunk-Dzc4VObD.js";import{s as b,tc as l,td as x,te as O,tf as F,tg as $,th as K,ti as M,tj as X,tk as Z,tl as w,a7 as T,mK as z,tm as H,tn as Q,to as _,tp as Y,tq as ee,gO as ae,h3 as j,gZ as te,gR as re,gS as ie,gV as y,g$ as oe,gW as f,gX as D,gT as h,E as ne,aL as se}from"./chunk-CMhy9c9G.js";import"./chunk-PTUe1aNG.js";import"./chunk-35-ZZMVr.js";import"./chunk-DHvBO4SR.js";import"./chunk-DAZPr-5t.js";import"./chunk-Ch0SDxT-.js";import"./chunk-Dc5RCiI0.js";import"./chunk-B-RuJrXv.js";import"./chunk-CNtoRp8i.js";import"./chunk-DobUN8tB.js";/* empty css              */import"./chunk--OMOLJvv.js";import"./chunk-hcQCkdqJ.js";import"./chunk-Cj_Zd08g.js";import"./chunk-igt1gBeK.js";import"./chunk-BqmX71u_.js";import"./chunk-2F9zfzHu.js";import"./chunk-DfjCgXDb.js";import"./chunk-ByM7454y.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */const le=X;async function me(a){if(!a?.layer||!a.view)throw new b("heatmap-statistics:missing-parameters","'layer' and 'view' parameters are required");const e=[l.CSVLayer,l.FeatureLayer,l.GeoJSONLayer,l.OGCFeatureLayer,l.OrientedImageryLayer,l.WFSLayer],{layer:i,...n}=a,o=x(i,e);if(!o)throw new b("heatmap-statistics:invalid-parameters","'layer' must be one of these types: "+O(e).join(", "));const t={layerAdapter:o,...n};t.radius=t.radius==null?t.blurRadius==null?18:F(t.blurRadius):t.radius;const c=t.signal!=null?{signal:t.signal}:null;await o.load(c);const u=t.field,s=u?o.getField(u):null,r=await $({field:u}),m=K(o,r,"heatmap-statistics:invalid-parameters");if(m)throw m;if(s){const p=M(o,s,"heatmap-statistics:invalid-parameters",le);if(p)throw p}return t}async function pe(a){const{layerAdapter:e,...i}=await me(a);return e.heatmapStatistics(i)}const k=.01;async function ce(a){if(!a?.layer||!a.view)throw new b("heatmap-renderer:missing-parameters","'layer' and 'view' parameters are required");const e={...a,layer:a.layer,view:a.view};e.radius??=e.blurRadius==null?18:F(e.blurRadius),e.minRatio??=.01,e.maxRatio??=1,e.fadeRatio??=.2,e.fadeToTransparent??=!0;const i=[l.CSVLayer,l.FeatureLayer,l.GeoJSONLayer,l.KnowledgeGraphSublayer,l.OGCFeatureLayer,l.OrientedImageryLayer,l.StreamLayer,l.WFSLayer],n=x(e.layer,i);if(!n)throw new b("heatmap-renderer:invalid-parameters","'layer' must be one of these types: "+O(i).join(", "));e.layer=n;const o=e.signal!=null?{signal:e.signal}:null;await n.load(o);const t=await $({field:e.field}),c=Z(n,t,"heatmap-renderer:invalid-parameters");if(c)throw c;return e}async function ue(a){let e=a.scheme,i=null,n=null;const o=await Y(a.basemap,a.view);if(i=o.basemapId!=null?o.basemapId:null,n=o.basemapTheme!=null?o.basemapTheme:null,e)return{scheme:_(e),basemapId:i,basemapTheme:n};const t=ee({basemapTheme:n});return t&&(e=t.primaryScheme,i=t.basemapId,n=t.basemapTheme),{scheme:e,basemapId:i,basemapTheme:n}}async function de(a,e){const{field:i,basemap:n,radius:o,fadeToTransparent:t,heatmapScheme:c,view:u}=e,{scheme:s,basemapId:r,basemapTheme:m}=await ue({basemap:n,scheme:c,view:u}),p=s.colors,R=p.length,L=a.min==null,V=L?[0,.04]:[a.min,a.max];let S;const C=e.fadeRatio??0,E=e.maxRatio??0,g=e.minRatio??0,B=(E-g)/(R-1),d=p[0],I=t?g:k,v=[new w({ratio:0,color:new T([d.r,d.g,d.b,0])}),new w({ratio:k,color:new T([d.r,d.g,d.b,0])}),new w({ratio:I,color:new T([d.r,d.g,d.b,I])})];return z(p,R).forEach((G,N)=>{const q=g+B*N;v.push(new w({ratio:q,color:G}))}),t&&(ye(v,C),S=new H({fadeRatio:C})),{renderer:new Q({authoringInfo:S,radius:o,colorStops:v,field:i,minDensity:V[0],maxDensity:V[1]}),statistics:a,defaultValuesUsed:L,scheme:_(s),basemapId:r,basemapTheme:m}}function ye(a,e){const i=10*(1-e)+1,n=a.length-3,o=a[2].color.a;a.forEach((t,c)=>{if(c<=2)return;const{color:u}=t,s=(c-3)/n;u.a=e===0?1:Math.min(Math.max(s*i+s+o,o),1)})}async function fe(a){const e=await ce(a);return de(e.statistics??await pe({layer:e.layer,field:e.field,radius:e.radius,view:e.view,filter:e.filter,signal:e.signal}),e)}const we=new A({baseURL:"/data"}),he=()=>we.request({method:"GET",url:"/point1.json"}).then(a=>a[0]),va=ae({__name:"index",setup(a){const e=j(),i=j([]),n=()=>{he().then(s=>{i.value=s.centerPoints.map((r,m)=>new ne({geometry:new se({longitude:r.centerPoint[0],latitude:r.centerPoint[1]}),attributes:{probabilityDensity:r.probabilityDensity,ranking:r.ranking,ObjectID:m}}))})};n();const o=s=>{const{result:r}=s;r&&console.log(r)},t=async s=>{const r=s.layer,m=s.view;await r.when(),m.goTo(i.value);const p=await fe({layer:r,view:m,field:"probabilityDensity"});console.log(p),e.value=p.renderer},c=()=>{n()},u=()=>{i.value=[]};return(s,r)=>{const m=te("ElButton");return re(),ie(h(P),null,{before:y(()=>[oe("p",null,[f(m,{onClick:r[0]||(r[0]=p=>c())},{default:y(()=>r[1]||(r[1]=[D("getTestData")])),_:1}),f(m,{onClick:u},{default:y(()=>r[2]||(r[2]=[D("清空")])),_:1})])]),default:y(()=>[f(h(U),{type:"img_w",spatialReference:{wkid:3857}}),f(h(J),null,{default:y(({spatialReference:p})=>[f(h(W),{spatialReference:p,renderer:e.value,source:i.value,fields:[{name:"ObjectID",type:"oid"},{name:"probabilityDensity",type:"double"},{name:"ranking",type:"double"}],"geometry-type":"point","object-id-field":"ObjectID",cursor:"pointer",onClick:o,onChange:t},null,8,["spatialReference","renderer","source"])]),_:1})]),_:1})}}});export{va as default};
