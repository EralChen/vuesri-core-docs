import{nY as F,nZ as P,n_ as z,n$ as L,o0 as U,U as D,ef as O,o1 as N,o2 as q,a7 as w,o3 as G,o4 as V,o5 as k,o6 as K,o7 as B,o8 as Q,o9 as C,oa as Y,ob as Z,oc as H,od as J,oe as h,of as W,og as X,oh as R,oi as S,oj as I,ok as ee,ol as te,om as A,on as j,oo as E,op as oe,oq as re,eT as v,eb as ne,dO as se,or as ae,os as le,ot as ie,d6 as ue,eU as M,ou as ce}from"./chunk-CGsGeN7j.js";import"./chunk-ByM7454y.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */function fe(e,t,o){const u=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,c=t.typedBufferStride,l=o?o.count:t.count;let s=(o?.dstIndex??0)*n,m=(o?.srcIndex??0)*c;for(let i=0;i<l;++i){for(let r=0;r<9;++r)u[s+r]=a[m+r];s+=n,m+=c}}Object.freeze(Object.defineProperty({__proto__:null,copy:fe},Symbol.toStringTag,{value:"Module"}));function me(e,t,o){const u=e.typedBuffer,n=e.typedBufferStride,a=t.typedBuffer,c=t.typedBufferStride,l=o?o.count:t.count;let s=(o?.dstIndex??0)*n,m=(o?.srcIndex??0)*c;for(let i=0;i<l;++i){for(let r=0;r<16;++r)u[s+r]=a[m+r];s+=n,m+=c}}Object.freeze(Object.defineProperty({__proto__:null,copy:me},Symbol.toStringTag,{value:"Module"}));function y(e,t){return new e(new ArrayBuffer(t*e.ElementCount*F(e.ElementType)))}async function nt(e,t,o){const u=new P(pe(o)),n=(await z(u,t,o,!0)).model,a=n.lods.shift(),c=new Map,l=new Map;n.textures.forEach(($,b)=>c.set(b,ge($))),n.materials.forEach(($,b)=>l.set(b,$e($,c)));const s=xe(a);for(const $ of s.parts)ye(s,$,l);const{position:m,normal:i,tangent:r,color:f,texCoord0:p}=s.vertexAttributes,x={position:m.typedBuffer,normal:i!=null?i.typedBuffer:null,tangent:r!=null?r.typedBuffer:null,uv:p!=null?p.typedBuffer:null,color:f!=null?f.typedBuffer:null},g=L(x,e,o);return{transform:g.transform,vertexSpace:g.vertexSpace,components:s.components,spatialReference:e.spatialReference,vertexAttributes:new U({position:g.vertexAttributes.position,normal:g.vertexAttributes.normal,tangent:g.vertexAttributes.tangent,color:x.color,uv:x.uv})}}function pe(e){const t=e?.resolveFile;return t?{busy:!1,request:async(o,u,n)=>{const a=t?.(o)??o;return(await D(a,{responseType:u==="image"?"image":u==="binary"?"array-buffer":"json",signal:n!=null?n.signal:null})).data}}:null}function T(e,t){if(e==null)return"-";const o=e.typedBuffer;return`${O(t,o.buffer,()=>t.size)}/${o.byteOffset}/${o.byteLength}`}function de(e){return e!=null?e.toString():"-"}function xe(e){let t=0;const o={color:!1,tangent:!1,normal:!1,texCoord0:!1},u=new Map,n=new Map,a=[];for(const c of e.parts){const{attributes:{position:l,normal:s,color:m,tangent:i,texCoord0:r}}=c,f=`
      ${T(l,u)}/
      ${T(s,u)}/
      ${T(m,u)}/
      ${T(i,u)}/
      ${T(r,u)}/
      ${de(c.transform)}
    `;let p=!1;const x=O(n,f,()=>(p=!0,{start:t,length:l.count}));p&&(t+=l.count),s&&(o.normal=!0),m&&(o.color=!0),i&&(o.tangent=!0),r&&(o.texCoord0=!0),a.push({gltf:c,writeVertices:p,region:x})}return{vertexAttributes:{position:y(ae,t),normal:o.normal?y(j,t):null,tangent:o.tangent?y(R,t):null,color:o.color?y(I,t):null,texCoord0:o.texCoord0?y(le,t):null},parts:a,components:[]}}function ge(e){return new N({data:(q(e.data),e.data),wrap:he(e.parameters.wrap)})}function $e(e,t){const o=new w(ve(e.color,e.opacity)),u=e.emissiveFactor?new w(we(e.emissiveFactor)):null,n=a=>a?new ie({scale:a.scale?[a.scale[0],a.scale[1]]:[1,1],rotation:ue(a.rotation??0),offset:a.offset?[a.offset[0],a.offset[1]]:[0,0]}):null;return new G({color:o,colorTexture:t.get(e.textureColor),normalTexture:t.get(e.textureNormal),emissiveColor:u,emissiveTexture:t.get(e.textureEmissive),occlusionTexture:t.get(e.textureOcclusion),alphaMode:be(e.alphaMode),alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,metallic:e.metallicFactor,roughness:e.roughnessFactor,metallicRoughnessTexture:t.get(e.textureMetallicRoughness),colorTextureTransform:n(e.colorTextureTransform),normalTextureTransform:n(e.normalTextureTransform),occlusionTextureTransform:n(e.occlusionTextureTransform),emissiveTextureTransform:n(e.emissiveTextureTransform),metallicRoughnessTextureTransform:n(e.metallicRoughnessTextureTransform)})}function ye(e,t,o){t.writeVertices&&Te(e,t);const{indices:u,attributes:n,primitiveType:a,material:c}=t.gltf;let l=V(u||n.position.count,a);const s=t.region.start;if(s){const m=new Uint32Array(l);for(let i=0;i<l.length;i++)m[i]+=s;l=m}e.components.push(new k({name:t.gltf.name,faces:l,material:o.get(c),shading:n.normal?"source":"flat",trustSourceNormals:!0}))}function Te(e,t){const{position:o,normal:u,tangent:n,color:a,texCoord0:c}=e.vertexAttributes,l=t.region.start,{attributes:s,transform:m}=t.gltf,i=s.position.count;if(K(o.slice(l,i),s.position,m),s.normal!=null&&u!=null){const r=B(M(),m),f=u.slice(l,i);Q(f,s.normal,r),C(r)&&Y(f,f)}else u!=null&&Z(u,0,0,1,{dstIndex:l,count:i});if(s.tangent!=null&&n!=null){const r=B(M(),m),f=n.slice(l,i);H(f,s.tangent,r),C(r)&&J(f,f)}else n!=null&&h(n,0,0,1,1,{dstIndex:l,count:i});if(s.texCoord0!=null&&c!=null?W(c.slice(l,i),s.texCoord0):c!=null&&X(c,0,0,{dstIndex:l,count:i}),s.color!=null&&a!=null){const r=s.color,f=a.slice(l,i);if(r.elementCount===4)r instanceof R?S(f,r,255):r instanceof I?ee(f,r):r instanceof te&&S(f,r,1/256);else{h(f,255,255,255,255);const p=A.fromTypedArray(f.typedBuffer,f.typedBufferStride);r instanceof j?E(p,r,255):r instanceof A?oe(p,r):r instanceof re&&E(p,r,1/256)}}else a!=null&&h(a.slice(l,i),255,255,255,255)}function be(e){switch(e){case"OPAQUE":return"opaque";case"MASK":return"mask";case"BLEND":return"blend"}}function he(e){return{horizontal:_(e.s),vertical:_(e.t)}}function _(e){switch(e){case v.CLAMP_TO_EDGE:return"clamp";case v.MIRRORED_REPEAT:return"mirror";case v.REPEAT:return"repeat"}}function d(e){return e**(1/ce)*255}function ve(e,t){return ne(d(e[0]),d(e[1]),d(e[2]),t)}function we(e){return se(d(e[0]),d(e[1]),d(e[2]))}export{nt as loadGLTFMesh};
