import{p as $,a as T,u as O}from"./chunk-I0Ze1Lq5.js";import{gT as k,nt as H,gZ as L,he as N,lF as S,bL as h,hc as M,gU as I,lC as v,lH as R,h8 as _,h0 as j,h9 as C,h6 as w,oG as F,hb as U}from"./chunk-fHrNL0KE.js";import{V as B,b as g,a as E,c as W}from"./chunk-kyamY1C6.js";import{u as q}from"./chunk-oihAJXyJ.js";import{_ as A,c as D}from"./chunk-Mv08grWe.js";function G(){const e=k("vaMediaLayer");if(!e)throw new Error("The component which use useMediaLayer() must be in a MediaLayer component");return e}const P={...$,defaultOptions:{type:Object,default:()=>({})},source:{type:Object,required:!0,default:()=>({})},retryTimes:{type:Number,default:5},retryInterval:{type:Number,default:1e3}},b={load:e=>e,click:e=>e,pointerMove:e=>e},ee=H(b),f="__va_media_layer_retries",Z=L({__name:"media-try",props:{retryTimes:{type:Number,default:5},retryInterval:{type:Number,default:1e3}},setup(e){const i=e,c=G(),o=c.source,l=N(),r=[],u=new WeakMap;S(()=>{r.forEach(t=>{t.remove()})}),r.push(c.on("layerview-create",t=>{l.value=t.layerView}));const y=t=>{l.value&&h(()=>!l.value?.updating).then(t)};o instanceof B&&(m(o.elements),o.elements.on("change",()=>{m(o.elements)}));function m(t){t.filter(a=>a.loadStatus!=="loaded").forEach(a=>{if(u.has(a))return;const s=h(()=>a.loadStatus==="failed");u.set(a,s),s.then(()=>{y(()=>{const n=t.find(d=>d===a);if(t.remove(n),n&&(n[f]??0)<i.retryTimes){const d=V(n,{[f]:(n[f]??0)+1,image:typeof a.image=="string"?a.image+"?t="+Date.now():a.image,id:n.id});setTimeout(()=>{y(()=>{t.add(d)})},i.retryInterval)}})})})}function V(t,a={}){let s=t;t instanceof g?s=new g({image:t.image,georeference:t.georeference,opacity:t.opacity}):t instanceof E&&(s=new E({video:t.video,georeference:t.georeference,opacity:t.opacity}));for(const n in a)s[n]=a[n];return s}return(t,a)=>M(t.$slots,"default")}}),z=L({name:"VaMediaLayer",components:{VaLayerHitEvents:A,MediaTry:Z},props:P,emits:b,setup(e,{emit:i}){const c=q(),o=c.map,l=D(i),r=new W({...e.defaultOptions});return I(()=>{r.source=e.source}),T(o,r,e),O(r,e),v("vaMediaLayer",r),v("vaLayer",r),i("load",{layer:r,view:c}),{hitEmits:l}}});function J(e,i,c,o,l,r){const u=_("VaLayerHitEvents"),y=_("MediaTry");return j(),C(U,null,[w(u,F(e.hitEmits),null,16),M(e.$slots,"default"),w(y,{"retry-times":e.retryTimes,"retry-interval":e.retryInterval},null,8,["retry-times","retry-interval"])],64)}const p=R(z,[["render",J]]);p.install=e=>{e.component(p.name||"VaMediaLayer",p)};export{p as V,ee as c,b as e,G as u};
