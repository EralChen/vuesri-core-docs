import{p as V,a as T,u as O}from"./chunk-BHw4eVQu.js";import{gW as k,nA as N,g$ as L,hg as S,lJ as H,b$ as h,he as M,gX as I,lG as v,lL as R,ha as _,h2 as j,hb as W,h7 as g,o$ as A,hd as B}from"./chunk-YzRi88Dj.js";import{V as C,b as w,a as E,c as F}from"./chunk-BjlDaQPD.js";import{u as U}from"./chunk-mQ0J7OJ8.js";import{_ as q,c as D}from"./chunk-Da7lMuRe.js";function G(){const e=k("vaMediaLayer");if(!e)throw new Error("The component which use useMediaLayer() must be in a MediaLayer component");return e}const J={...V,defaultOptions:{type:Object,default:()=>({})},source:{type:Object,required:!0,default:()=>({})},retryTimes:{type:Number,default:5},retryInterval:{type:Number,default:1e3}},$={load:e=>e,click:e=>e,pointerMove:e=>e},ee=N($),f="__va_media_layer_retries",P=L({__name:"media-try",props:{retryTimes:{type:Number,default:5},retryInterval:{type:Number,default:1e3}},setup(e){const i=e,c=G(),o=c.source,l=S(),r=[],u=new WeakMap;H(()=>{r.forEach(a=>{a.remove()})}),r.push(c.on("layerview-create",a=>{l.value=a.layerView}));const d=a=>{l.value&&h(()=>!l.value?.updating).then(a)};o instanceof C&&(m(o.elements),o.elements.on("change",()=>{m(o.elements)}));function m(a){a.filter(t=>t.loadStatus!=="loaded").forEach(t=>{if(u.has(t))return;const s=h(()=>t.loadStatus==="failed");u.set(t,s),s.then(()=>{d(()=>{const n=a.find(y=>y===t);if(a.remove(n),n&&(n[f]??0)<i.retryTimes){const y=b(n,{[f]:(n[f]??0)+1,image:typeof t.image=="string"?t.image+"?t="+Date.now():t.image,id:n.id});setTimeout(()=>{d(()=>{a.add(y)})},i.retryInterval)}})})})}function b(a,t={}){let s=a;a instanceof w?s=new w({image:a.image,georeference:a.georeference,opacity:a.opacity}):a instanceof E&&(s=new E({video:a.video,georeference:a.georeference,opacity:a.opacity}));for(const n in t)s[n]=t[n];return s}return(a,t)=>M(a.$slots,"default")}}),X=L({name:"VaMediaLayer",components:{VaLayerHitEvents:q,MediaTry:P},props:J,emits:$,setup(e,{emit:i}){const c=U(),o=c.map,l=D(i),r=new F({...e.defaultOptions});return I(()=>{r.source=e.source}),T(o,r,e),O(r,e),v("vaMediaLayer",r),v("vaLayer",r),i("load",{layer:r,view:c}),{hitEmits:l}}});function z(e,i,c,o,l,r){const u=_("VaLayerHitEvents"),d=_("MediaTry");return j(),W(B,null,[g(u,A(e.hitEmits),null,16),M(e.$slots,"default"),g(d,{"retry-times":e.retryTimes,"retry-interval":e.retryInterval},null,8,["retry-times","retry-interval"])],64)}const p=R(X,[["render",z]]);p.install=e=>{e.component(p.name||"VaMediaLayer",p)};export{p as V,ee as c,$ as e,G as u};
