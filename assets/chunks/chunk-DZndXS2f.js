import{e7 as n,g5 as g,bF as d,g6 as l,am as u,z as c,gb as y,e8 as f,an as _,a1 as o,a2 as s,a4 as H}from"./chunk-CMhy9c9G.js";import{F as w}from"./chunk-BOG1QSRE.js";import{h as $}from"./chunk-DOGyYeMk.js";import{_ as v}from"./chunk-DpoZ3ulm.js";import{i as x}from"./chunk-BghrPabN.js";import{R as b}from"./chunk-CcOrtoq3.js";import"./chunk-ByM7454y.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-CD9yU3wS.js";import"./chunk-DNnuvc1i.js";import"./chunk-CUzevAry.js";import"./chunk-DvGL8dtf.js";import"./chunk-YA9YD_OS.js";import"./chunk-CvgiXnaQ.js";import"./chunk-iAha9nPY.js";import"./chunk-D1fDIYeK.js";import"./chunk-CLknGTw1.js";import"./chunk-DfBjMReh.js";import"./chunk-F8oTIn7N.js";import"./chunk-AgXG-2tE.js";import"./chunk-N_vz0V2G.js";import"./chunk-CjSui6k2.js";import"./chunk-C4Yx2DVu.js";import"./chunk-DjDIt6nn.js";import"./chunk-BSi4oUWq.js";import"./chunk-BPVd6ESQ.js";import"./chunk-CeYath0a.js";import"./chunk-DaLUiyab.js";import"./chunk-BiAAMMdb.js";let p=class extends x(n(g(d))){constructor(){super(...arguments),this._highlightGraphics=new l,this._updateHash=""}fetchPopupFeaturesAtLocation(t,i){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(t,i)}update(t){const i=`${this.exportImageVersion}/${t.state.id}/${t.pixelRatio}/${t.stationary}`;this._updateHash!==i&&(this._updateHash=i,this.strategy.update(t).catch(e=>{u(e)||c.getLogger(this).error(e)}),t.stationary&&this._popupHighlightHelper.updateHighlightedFeatures(t.state.resolution)),this._highlightView.processUpdate(t)}attach(){const{imageMaxWidth:t,imageMaxHeight:i,version:e}=this.layer,r=e>=10.3,m=e>=10;this._bitmapContainer=new y,this.container.addChild(this._bitmapContainer),this._highlightView=new w({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new $(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1}),this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new b({createFetchPopupFeaturesQueryGeometry:(a,h)=>f(a,h,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(a,h)=>{this._highlightView.graphicUpdateHandler({graphic:a,property:h})},layerView:this,updatingHandles:this._updatingHandles}),this.strategy=new v({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:t,imageMaxHeight:i,imageRotationSupported:r,imageNormalizationSupported:m,hidpi:!0}),this.addAttachHandles(_(()=>this.exportImageVersion,()=>this.requestUpdate())),this.requestUpdate()}detach(){this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy(),this._popupHighlightHelper.destroy()}viewChange(){}moveEnd(){this.requestUpdate()}supportsSpatialReference(t){return this.layer.serviceSupportsSpatialReference(t)}async doRefresh(){this._updateHash="",this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(t,i,e,r){return this.layer.fetchImage(t,i,e,{timeExtent:this.timeExtent,floors:this.floors,...r})}fetchImageBitmap(t,i,e,r){return this.layer.fetchImageBitmap(t,i,e,{timeExtent:this.timeExtent,floors:this.floors,...r})}highlight(t){return this._popupHighlightHelper.highlight(t)}};o([s()],p.prototype,"strategy",void 0),o([s()],p.prototype,"updating",void 0),p=o([H("esri.views.2d.layers.MapImageLayerView2D")],p);const Ft=p;export{Ft as default};
