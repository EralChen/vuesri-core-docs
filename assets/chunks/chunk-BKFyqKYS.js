import{p as $,c as E,h as T}from"./chunk-35-ZZMVr.js";import{ck as S,a3 as I,gO as k,lC as N,gL as _,gM as z,h1 as b,h3 as g,lo as P,gP as M,lq as q,lE as B,gZ as h,gR as f,gS as y,gV as d,h9 as v,pz as D,gY as O,gW as V,gT as c}from"./chunk-CMhy9c9G.js";import{V as Z}from"./chunk-CRzVAIWE.js";import{s as A}from"./chunk-DHvBO4SR.js";import{u as F}from"./chunk-Dc5RCiI0.js";import"./chunk-BY_FN4O4.js";import"./chunk-Dx0NO5tE.js";import"./chunk-hcQCkdqJ.js";import"./chunk-BCEYKtyI.js";import"./chunk-DfjCgXDb.js";import"./chunk-DIHKnm4l.js";import"./chunk-TufeK50d.js";import"./chunk-Dck1UqdK.js";import{V as Y}from"./chunk-B4Rwpdzs.js";import"./chunk-igt1gBeK.js";import"./chunk-Cj_Zd08g.js";import"./chunk-BG40D5IJ.js";import"./chunk-Dzc4VObD.js";import{V as U}from"./chunk-DjjaYBlz.js";import"./chunk-CM_lIypp.js";import"./chunk-CmV2Xkqf.js";import"./chunk-CbY12eax.js";import"./chunk-BcJWwafW.js";import"./chunk-ClYvIdCO.js";import"./chunk-QvQIJROn.js";import"./chunk-CdctZqhD.js";import"./chunk-DaHzAMiu.js";import"./chunk-C1aYhagP.js";import"./chunk-BU_CQVD8.js";import"./chunk-D_aEPSIR.js";import"./chunk-CAaD5fpi.js";import"./chunk-C0Px4IH5.js";import"./chunk-gN39URxt.js";import"./chunk-HNqUD5wH.js";import"./chunk-3xYMskso.js";import"./chunk-etnkt-xL.js";import"./chunk-oE2be0WM.js";import"./chunk-BnPJJ4xW.js";import"./chunk-DdA8NjGq.js";import"./chunk-scr1RBcv.js";import"./chunk-BVa6-kjc.js";import"./chunk-CIKSIPV2.js";import{V as G,s as x}from"./chunk-UsAGatjR.js";import"./chunk-C5o2Zojc.js";import"./chunk-DAZPr-5t.js";import"./chunk-Ch0SDxT-.js";import"./chunk-ByM7454y.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-Dz7Zvk-S.js";import"./chunk-DobUN8tB.js";/* empty css              */import"./chunk-B-RuJrXv.js";import"./chunk-CNtoRp8i.js";import"./chunk-CLFhYyJ8.js";import"./chunk-CLwfGE1I.js";import"./chunk--OMOLJvv.js";import"./chunk-BqmX71u_.js";import"./chunk-2F9zfzHu.js";import"./chunk-PTUe1aNG.js";/* empty css              */import"./chunk-DZzPOt9C.js";/* empty css              *//* empty css              */import"./chunk-CNgyMX9t.js";import"./chunk-frOQcENt.js";import"./chunk-Ds9r7LkQ.js";import"./chunk-_SCJxduo.js";import"./chunk-zKPkODU6.js";const H={...$,layerName:{type:String,required:!0},spatialReference:{type:Object,default:()=>({wkid:3857})},url:{type:String,required:!0},token:{type:String,default:""},paint:null,queryable:{type:Boolean,default:!1}},J={load:r=>r,click:r=>r};/* @preserve
* @terraformer/arcgis - v2.1.1 - MIT
* Copyright (c) 2012-2022 Environmental Systems Research Institute, Inc.
* Tue Aug 02 2022 14:23:48 GMT-0700 (Pacific Daylight Time)
*/var K=function(e,o){for(var t=0;t<e.length;t++)if(e[t]!==o[t])return!1;return!0},R=function(e){return K(e[0],e[e.length-1])||e.push(e[0]),e},w=function(e){var o=0,t=0,a=e.length,i=e[t],n;for(t;t<a-1;t++)n=e[t+1],o+=(n[0]-i[0])*(n[1]+i[1]),i=n;return o>=0},W=function(e){var o={};for(var t in e)e.hasOwnProperty(t)&&(o[t]=e[t]);return o},C=function(e){var o=[],t=e.slice(0),a=R(t.shift().slice(0));if(a.length>=4){w(a)||a.reverse(),o.push(a);for(var i=0;i<t.length;i++){var n=R(t[i].slice(0));n.length>=4&&(w(n)&&n.reverse(),o.push(n))}}return o},X=function(e){for(var o=[],t=0;t<e.length;t++)for(var a=C(e[t]),i=a.length-1;i>=0;i--){var n=a[i].slice(0);o.push(n)}return o},Q=function r(e,o){o=o||"OBJECTID";var t={wkid:4326},a={},i;switch(e.type){case"Point":a.x=e.coordinates[0],a.y=e.coordinates[1],e.coordinates[2]!=null&&(a.z=e.coordinates[2]),a.spatialReference=t;break;case"MultiPoint":a.points=e.coordinates.slice(0),e.coordinates[0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"LineString":a.paths=[e.coordinates.slice(0)],e.coordinates[0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"MultiLineString":a.paths=e.coordinates.slice(0),e.coordinates[0][0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"Polygon":a.rings=C(e.coordinates.slice(0)),e.coordinates[0][0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"MultiPolygon":a.rings=X(e.coordinates.slice(0)),e.coordinates[0][0][0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"Feature":e.geometry&&(a.geometry=r(e.geometry,o)),a.attributes=e.properties?W(e.properties):{},e.id&&(a.attributes[o]=e.id);break;case"FeatureCollection":for(a=[],i=0;i<e.features.length;i++)a.push(r(e.features[i],o));break;case"GeometryCollection":for(a=[],i=0;i<e.geometries.length;i++)a.push(r(e.geometries[i],o));break}return a};function j(r,e,o){return Q(r,e)}async function ee(r,e){return S(r,{responseType:"json",query:{LAYER:e.LAYER,token:e.token,SERVICE:"mvt"}}).then(o=>{const t=o.data,a=JSON.parse(t.bbox),i=j(a),n=new I(i);return t.bbox=n,t.fullExtent=n.extent,t})}function te(r,e){return S(r,{responseType:"json",headers:{token:e.token},query:{layerName:e.layerName,point:`${e.longitude},${e.latitude}`}}).then(o=>o)}const re=k({__name:"on-click",props:{token:{type:String,default:""},baseUrl:{type:String,default:""},layerName:{type:String,default:""}},emits:{click:null},setup(r,{emit:e}){const o=r,t=e,i=F()[A],n=E(i),s=new n("click",async p=>{te(o.baseUrl+"/vector/getVectorInfo",{token:o.token,layerName:o.layerName,latitude:p.event.mapPoint.latitude,longitude:p.event.mapPoint.longitude}).then(l=>{t("click",{...p,requestResponse:l})})});return s.add(),N(()=>{s.remove()}),_(()=>{s.remove()}),z(()=>{s.add()}),(p,l)=>b(p.$slots,"default")}}),ae=k({name:"VaSkzzVectorTileLayer",components:{VaVectorTileLayer:Z,OnClick:re},props:H,emits:J,setup(r,{emit:e}){const o=T(r,[]),t=g({}),a=P(()=>{const l={layers:[],version:8,sources:{}};if(t.value.id){l.layers=[{...t.value,paint:r.paint}];const m=t.value.source;m&&(l.sources[m]={type:"vector",tiles:new Array(10).fill(0).map((ie,L)=>`${r.url}/mvt?LAYER=${t.value.id}&SRS=${r.spatialReference.wkid||3857}&SERVICE=mvt&x={x}&y={y}&z={z}&token=${r.token}`.replace("t1",`t${L+1}`))})}return l});M(()=>r.layerName,n,{immediate:!0});const i=g();async function n(){return ee(r.url+"/mvtInfo",{LAYER:r.layerName,token:r.token}).then(l=>{t.value={id:l.id,source:l.source,"source-layer":l["source-layer"],type:l.type},i.value=l})}const s=q(()=>{t.value.id,{...r.paint}});return{layerProps:o,style:a,layerSource:t,ready:s,layerLoad:async l=>{const m=l.layer;i.value&&(m.capabilitiesResponse=i.value),e("load",{view:l.view,layer:m})}}}});function oe(r,e,o,t,a,i){const n=h("OnClick"),s=h("VaVectorTileLayer");return r.ready&&r.layerSource.id?(f(),y(s,{key:0,style:D(r.style),onLoad:r.layerLoad},{default:d(()=>[r.queryable?(f(),y(n,{key:0,"base-url":r.url,token:r.token,"layer-name":r.layerName,onClick:e[0]||(e[0]=p=>r.$emit("click",p))},null,8,["base-url","token","layer-name"])):v("",!0),b(r.$slots,"default")]),_:3},8,["style","onLoad"])):v("",!0)}const u=B(ae,[["render",oe]]);u.install=r=>{r.component(u.name||"VaSkzzVectorTileLayer",u)};const Xt=k({__name:"basic",setup(r){const e=O({url:"http://192.168.110.151:33334/zz-mapServer/mapServer/layer",layerName:"V20240605-000003-P3",token:"EAD28020541B4DD1A30C3FE257FB8C369563VEMZVK1YXUJT"}),o=[{templateType:"VkfInput",label:"url",prop:"url"},{templateType:"VkfInput",label:"图层名称",prop:"layerName"},{templateType:"VkfInput",label:"token",prop:"token"}],t={"circle-color":"#ff0000"},a=async n=>{const s=n.view;await s.when(),await n.layer.when();const p=n.layer.capabilitiesResponse.fullExtent;s.goTo(p)},i=async n=>{console.log(n.requestResponse?.data,"e.requestResponse.data")};return(n,s)=>(f(),y(c(U),null,{before:d(()=>[V(c(G),{"form-items":o,data:e,onSetData:s[0]||(s[0]=p=>c(x)(e,p))},null,8,["data"])]),default:d(()=>[V(c(Y),{type:"img_w","spatial-reference":{wkid:3857}}),e.layerName?(f(),y(c(u),{key:0,url:e.url,"layer-name":e.layerName,token:e.token,paint:t,queryable:!0,onLoad:a,onClick:i},null,8,["url","layer-name","token"])):v("",!0)]),_:1}))}});export{Xt as default};
