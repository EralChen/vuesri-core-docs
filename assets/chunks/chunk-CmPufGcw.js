import{ep as j,xO as ye,Gp as Ye,Gq as Ze,bq as J,Gr as Te,Gs as Oe,Gt as Je,Gu as Ke,Gv as Qe,Gw as et,Gx as tt,Gy as st,oo as rt,Gz as it,GA as nt,oU as at,GB as ot,GC as ct,GD as dt,GE as lt,iB as T,iA as ut,iE as $e,jW as gt,xP as se,d8 as ht,zh as pt,o3 as d,cy as R,zf as Ve,d9 as M,b4 as K,cw as b,o4 as p,x6 as ge,sv as F,vQ as He,sy as k,tI as We,sn as y,fa as A,fb as x,cv as w,sq as ft,DT as bt,GF as oe,GG as mt,GH as _t,lg as Tt,xi as De,b9 as Ot,aL as $t,iN as wt,o_ as je,b2 as It,sf as Ct,GI as At,se as ke,GJ as ce,nh as we,so as vt,bB as Ie,AS as Et,z as Pt,wX as he,iP as D,zb as Rt,an as pe,a0 as fe,a7 as v,x4 as m,za as L,x5 as _,cu as P,zi as Fe,xd as Mt,xb as Be,bo as xt,br as Ce,x7 as q,iH as X,a_ as Q,zg as Ae,qr as ve,ht as ne,hs as Ee,GK as Pe,GL as Re,xk as Me,DQ as Gt}from"./chunk-CMhy9c9G.js";import{g as St,e as Lt,i as xe,u as Ge,v as Ut,C as Z,j as Nt,k as yt,q as Vt,b as Ht,d as Se,s as Wt,n as ze,x as de,U as Dt,S as Le,l as jt,a as kt,c as Ft}from"./chunk-C1MThlsS.js";import{I as Bt}from"./chunk-DmemvuQy.js";import{d as zt,r as qt}from"./chunk-CiR1Ehve.js";import{f as Xt}from"./chunk-CmN077Ld.js";import{_ as Yt}from"./chunk-ByM7454y.js";const Zt=j(0,0,0,.04);function Jt({accentColor:e}){return ye(e,.5)}function Kt({accentColor:e}){return ye(e,.7)}function qe(e){const t=new Ye,{vertex:a,fragment:r,attributes:i,varyings:n}=t;return Ze(a,e),i.add(J.POSITION,"vec3"),i.add(J.UV0,"vec2"),n.add("vUV","vec2"),a.main.add(Te`vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);`),r.uniforms.add(new Oe("backgroundColor",s=>s.backgroundColor),new Oe("gridColor",s=>s.gridColor),new Je("gridWidth",s=>s.gridWidth)).main.add(Te`const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
fragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;`),t}const Qt=Object.freeze(Object.defineProperty({__proto__:null,build:qe},Symbol.toStringTag,{value:"Module"}));class es extends Ke{constructor(){super(...arguments),this.backgroundColor=j(1,0,0,.5),this.gridColor=j(0,1,0,.5),this.gridWidth=4}}class ts extends Qe{constructor(t,a,r){super(t,a,new et(Qt,()=>Yt(()=>Promise.resolve().then(()=>bs),void 0)),r)}initializePipeline(){return tt({blending:st,depthTest:{func:rt.LESS},colorWrite:it})}}let ss=class extends nt{constructor(t){super(t,is),this.produces=new Map([[at.TRANSPARENT_MATERIAL_WITHOUT_DEPTH,a=>a===ot.Color]])}get visible(){return!0}createGLMaterial(t){return new rs(t)}createBufferWriter(){return new ct(Xt)}getConfiguration(){return dt}};class rs extends lt{constructor(t){super(t)}beginSlot(t){return this.acquireTechnique(ts,t)}}class is extends es{constructor(){super(...arguments),this.renderOccluded=T.Occlude,this.isDecoration=!1}}class ns extends ut{constructor(t){super(t),this._material=null,this._renderOccluded=T.OccludeAndTransparent,this._gridWidth=1,this._gridColor=j(1,0,0,1),this._backgroundColor=j(1,0,0,1),this.applyProperties(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._updateMaterial())}get gridWidth(){return this._gridWidth}set gridWidth(t){this._gridWidth!==t&&(this._gridWidth=t,this._updateMaterial())}get gridColor(){return this._gridColor}set gridColor(t){$e(this._gridColor,t),this._updateMaterial()}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){$e(this._backgroundColor,t),this._updateMaterial()}createExternalResources(){this._material=new ss(this._materialParameters)}destroyExternalResources(){this._material=null}forEachExternalMaterial(t){this._material!=null&&t(this._material)}createGeometries(t){if(this._material!=null){const a=gt(this._material);t.addGeometry(a)}}get _materialParameters(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateMaterial(){this._material!=null&&this._material.setParameters(this._materialParameters)}}function Cs(e,t,a,r,i,n,s,o){return as(t,s.worldUpAtPosition(e,d.get()),i,n,o.basis1,o.basis2),p(o.basis1,o.basis1,a),p(o.basis2,o.basis2,r),R(o.origin,e),We(o.basis2,o.basis1,o.origin,o.plane),o}function as(e,t,a,r,i,n){const s=y(e,t),o=d.get(),l=d.get();switch(r===E.HORIZONTAL_OR_VERTICAL?Math.abs(s)>Lt?E.HORIZONTAL:E.VERTICAL:r){case E.VERTICAL:{const c=Math.abs(s)<=xe?e:a.viewUp;A(o,c,t),R(l,t);break}case E.HORIZONTAL:A(o,a.viewUp,t),A(l,t,o);break;case E.TILTED:{const c=Math.abs(s)<=xe?t:a.viewUp;A(o,c,e),A(l,e,o);break}}const u=A(d.get(),o,l);y(u,a.viewForward)>0&&p(l,l,-1),x(i,o),x(n,l)}function os(e,t,a){const r=t.worldUpAtPosition(e.origin,d.get()),i=e.basis1,n=_e(e,r),s=Math.round(n/V)*V;return ce(e,s-n,i,a)}function As(e,t,a,r,i,n){const s=R(d.get(),i.origin);b(s,s,p(d.get(),i.basis1,e.direction[0]<0?1:-1)),b(s,s,p(d.get(),i.basis2,e.direction[1]<0?1:-1));const o=M(i.basis1),l=M(i.basis2),u=w(d.get(),a,s),c=w(d.get(),t,s);let g=0,h=0;if(me(e)){const re=le(i),H=le(n);g=o-.5*e.direction[0]*y(i.basis1,c)/o,h=l-.5*e.direction[1]*y(i.basis2,c)/l;const B=H/re;g*=B,h*=B}const f=g+.5*e.direction[0]*y(i.basis1,u)/o,$=h+.5*e.direction[1]*y(i.basis2,u)/l,U=p(d.get(),i.basis1,f/o),G=p(d.get(),i.basis2,$/l);(f<=0||Ue(n.origin,U,r)<=Ge)&&R(U,n.basis1),($<=0||Ue(n.origin,G,r)<=Ge)&&R(G,n.basis2);const O=R(d.get(),s);return b(O,O,p(d.get(),U,e.direction[0]<0?-1:1)),b(O,O,p(d.get(),G,e.direction[1]<0?-1:1)),ft(O,U,G,n)}function vs(e,t){return Ut*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}function Es(e,t,a,r){const i=A(d.get(),t,a);return A(i,i,t),Ve(e,i,r)}function Ps(e,t){return pt(e.basis1,e.basis2,e.origin,t)}function Rs(e,t,a,r){const i=t.worldUpAtPosition(e.origin,d.get()),n=d.get();switch(a){case ee.HEADING:R(n,i);break;case ee.TILT:R(n,e.basis1)}return Ve(e.origin,n,r)}function Ms(e,t,a,r){const i=be(a,I.NEGATIVE_X),n=F.get();bt(n,t,i.edge*Math.PI/2);const s=x(d.get(),i.basis);let o=p(d.get(),s,i.direction*r.computeScreenPixelSizeAt(i.position)*Z);b(o,o,i.position);const l=r.projectToRenderScreen(o,oe(d.get())),u=cs(r,l);mt(r,l,Y),x(Y.direction,Y.direction);const c=d.get();!u&&_t(a,Y,c)&&(o=c),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=Tt(o),u?e.state|=te:e.state&=~te}function cs(e,t){const[a,r,i,n]=e.viewport,s=Math.min(i,n)/16;let o=!0;return t[0]<a+s?(t[0]=a+s,o=!1):t[0]>a+i-s&&(t[0]=a+i-s,o=!1),t[1]<r+s?(t[1]=r+s,o=!1):t[1]>r+n-s&&(t[1]=r+n-s,o=!1),o}function xs(e,t,a,r){const i=M(r.basis1),n=M(r.basis2),s=Xe(r),o=le(r),l=K(d.get(),0,0,0);b(l,p(d.get(),r.basis1,t.direction[0]),p(d.get(),r.basis2,t.direction[1])),b(l,r.origin,l);let u=0,c=1;if(me(t))t.direction[0]===1&&t.direction[1]===-1?u=V:t.direction[0]===1&&t.direction[1]===1?u=Math.PI:t.direction[0]===-1&&t.direction[1]===1&&(u=3*Math.PI/2),c=o;else{const h=t.direction[0]!==0?1:2;u=h===1?V:0,c=(h===1?n:i)-s}const g=ge(F.get(),u);He(g,g,K(d.get(),c,c,c)),k(g,a,g),g[12]=0,g[13]=0,g[14]=0,e.modelTransform=g,e.renderLocation=l}function Gs(e,t,a,r){const i=r.worldUpAtPosition(a.origin,d.get()),n=be(a,I.POSITIVE_X),s=ge(F.get(),n.edge*Math.PI/2);De(s,s,-_e(a,i)),k(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=n.position}function Ss(e,t,a){const r=be(a,I.POSITIVE_Y),i=ge(F.get(),r.edge*Math.PI/2);De(i,i,V),k(i,t,i),i[12]=0,i[13]=0,i[14]=0,e.modelTransform=i,e.renderLocation=r.position}var I;function be(e,t){switch(t){case I.POSITIVE_X:return{basis:e.basis1,direction:1,position:b(d.get(),e.origin,e.basis1),edge:t};case I.POSITIVE_Y:return{basis:e.basis2,direction:1,position:b(d.get(),e.origin,e.basis2),edge:t};case I.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:w(d.get(),e.origin,e.basis1),edge:t};case I.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:w(d.get(),e.origin,e.basis2),edge:t}}}function Ue(e,t,a){const r=a.projectToRenderScreen(b(d.get(),e,t),oe(d.get())),i=a.projectToRenderScreen(w(d.get(),e,t),oe(d.get()));return Ot(w(r,r,i))}function Xe(e){const t=M(e.basis1),a=M(e.basis2);return St*Math.min(t,a)}function le(e){return Xe(e)}function me(e){return e.direction[0]!==0&&e.direction[1]!==0}function Ls(e){const t=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]];return new zt({view:e,attached:!1,color:Kt(e.effectiveTheme),width:Nt,renderOccluded:T.OccludeAndTransparent,geometry:[t],isDecoration:!0})}function Us(e){return new ns({view:e,attached:!1,backgroundColor:Zt,gridColor:Jt(e.effectiveTheme),gridWidth:4,renderOccluded:T.OccludeAndTransparent,isDecoration:!0})}function Ns(e,t,a,r=new Ct){if(e==null)return null;const{renderCoordsHelper:i}=t,n=i.fromRenderCoords(e.origin,new $t({spatialReference:t.spatialReference}));if(n==null)return null;const s=wt(n,a);if(s==null)return null;r.position=s;const o=2*M(e.basis1),l=2*M(e.basis2),u=je.renderUnitScaleFactor(t.spatialReference,a);r.width=o*u,r.height=l*u;const c=i.worldUpAtPosition(e.origin,d.get());return r.tilt=It(_e(e,c)),r.heading=i.headingAtPosition(e.origin,e.basis1)-90,r}function _e(e,t){return At(t,e.basis2,e.basis1)+V}function ds(e,t,a,r,i,n,s=ke()){return n.toRenderCoords(e,s.origin)?(n.worldBasisAtPosition(s.origin,we.X,s.basis1),n.worldBasisAtPosition(s.origin,we.Y,s.basis2),We(s.basis2,s.basis1,s.origin,s.plane),ce(s,-Ie(t),vt(s),s),ce(s,Ie(a),s.basis1,s),p(s.basis1,s.basis1,r/2),p(s.basis2,s.basis2,i/2),Et(s),s):(Pt.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error(`Failed to project slice plane position, projection from ${e.spatialReference.wkid} is not supported`),null)}function ys(e,t){if(e?.position==null)return null;const a=qt(e.position,t.spatialReference,t.elevationProvider);if(a==null)return null;const r=je.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),i=e.width*r,n=e.height*r;return{position:a,heading:e.heading,tilt:e.tilt,renderWidth:i,renderHeight:n}}function Vs(e,t,a,r=ke()){if(e==null)return null;const i=ds(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,r);return a.tiltEnabled||i==null||os(i,t.renderCoordsHelper,i),i}(function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"})(I||(I={}));const C=se.Custom1;var ee,E;(function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"})(ee||(ee={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(E||(E={}));const te=se.Custom2,Y=ht(),V=Math.PI/2,ae=se.Custom1,ls=se.Custom2;function Hs(e){return(e.type==="building-scene-3d"?e:null)!=null}let Ws=class extends he{constructor(t,a){const r=me(a),i=r?Ht:Se,n=i*Wt,s=Se,o={renderOccluded:T.OccludeAndTransparent,isDecoration:!0},l=new D({...o,width:i}),u=new D({...o,width:n}),c=new D({...o,width:s});super({view:t,...Rt,...us({isCorner:r,unfocusedMaterial:l,focusedMaterial:u,outlineMaterial:c})}),this._themeHandle=pe(()=>t.effectiveTheme.accentColor,g=>{const h=v.toUnitRGBA(g);l.setParameters({color:h}),u.setParameters({color:h}),c.setParameters({color:h})},fe)}destroy(){this._themeHandle.remove(),super.destroy()}};function us({isCorner:e,unfocusedMaterial:t,focusedMaterial:a,outlineMaterial:r}){const i=e?[P(1,0,0),P(0,0,0),P(0,1,0)]:[P(1,0,0),P(-1,0,0)];return{renderObjects:[new m(L(t,i),_.Unfocused|ae),new m(L(a,i),_.Focused|ae),new m(L(r,i),ls)],collisionType:{type:"line",paths:[i]},radius:e?yt:Vt,state:ae}}class js extends he{constructor(t,a){const r=new Bt({writeDepth:!1,renderOccluded:T.Opaque,isDecoration:!0}),i=Fe.calloutWidth,n=new D({width:i,renderOccluded:T.OccludeAndTransparent,isDecoration:!0});super({view:t,...gs({imageMaterial:r,calloutMaterial:n})}),this._currentTexture=null,this._themeHandle=pe(()=>t.effectiveTheme.accentColor,s=>{const o=Mt(s,.5),l=Be(s),u=this._currentTexture,c=a(o,l);r.setParameters({textureId:c.texture.id}),n.setParameters({color:v.toUnitRGBA(s)}),this._currentTexture=c,u?.release()},fe)}destroy(){this._themeHandle.remove(),this._currentTexture?.release(),super.destroy()}}function gs({imageMaterial:e,calloutMaterial:t}){const{focusMultiplier:a,calloutLength:r,discRadius:i}=Fe,n=i*a,s=(c,g)=>{const h=[0,1,2,2,3,0];return new xt(g,[[J.POSITION,new Ce([r-c,-c,0,r+c,-c,0,r+c,c,0,r-c,c,0],h,3,!0)],[J.UV0,new Ce([0,0,1,0,1,1,0,1],h,2,!0)]])},o=L(t,[[0,0,0],[r-i,0,0]]),l=L(t,[[0,0,0],[r-n,0,0]]),u=C;return{autoScaleRenderObjects:!1,collisionPriority:1,collisionType:{type:"disc",direction:[0,0,1],offset:[r,0,0]},focusMultiplier:a,radius:i,renderObjects:[new m(s(i,e),_.Unfocused|u),new m(o,_.Unfocused|u),new m(s(n,e),_.Focused|u),new m(l,_.Focused|u)],state:u}}var ue;(function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"})(ue||(ue={}));class ks extends he{constructor(t,a){const r=new D({width:1,renderOccluded:T.OccludeAndTransparent,isDecoration:!0}),i=new q({cullFace:X.Back,renderOccluded:T.Opaque,isDecoration:!0}),n=new q({cullFace:X.Back,renderOccluded:T.Opaque,isDecoration:!0}),s=new q({cullFace:X.Back,renderOccluded:T.Opaque,isDecoration:!0}),o=new q({writeDepth:!1,cullFace:X.Front,renderOccluded:T.Transparent,isDecoration:!0});super({view:t,...hs({offsetMode:a,tubeMaterial:i,tipMaterial:n,capMaterial:s,outlineMaterial:o,calloutMaterial:r})}),this._themeHandle=pe(()=>t.effectiveTheme.accentColor,l=>{const u=Be(l),c=v.toUnitRGBA(l),g=v.toUnitRGBA(u),h=v.toUnitRGBA(v.blendColors(u,l,.4)),f=v.toUnitRGBA(v.blendColors(u,l,.14));r.setParameters({color:c}),i.setParameters({color:f}),n.setParameters({color:g}),s.setParameters({color:h}),o.setParameters({color:c})},fe)}destroy(){this._themeHandle.remove(),super.destroy()}}function hs({offsetMode:e,tubeMaterial:t,tipMaterial:a,capMaterial:r,outlineMaterial:i,calloutMaterial:n}){const s=e===ue.CENTER_ON_CALLOUT?Z:0,o=[P(s,0,-Le/2),P(s,0,Le/2)],l=fs(o),u=Ne({vertices:o,padding:0,materials:{tube:t,tip:a,cap:r}}),c=Ne({vertices:o,padding:Dt,materials:{tube:i,tip:i,cap:i}}),g=L(n,[[s,0,0],[s-Z,0,0]]),h=L(n,[[s,0,0],[s-Z,0,0]]);return{renderObjects:[...u.normal.map(f=>new m(f,_.Unfocused|C)),...c.normal.map(f=>new m(f,_.Unfocused|C)),new m(g,_.Unfocused|C|te),...u.focused.map(f=>new m(f,_.Focused|C)),...c.focused.map(f=>new m(f,_.Focused|C)),new m(h,_.Focused|C|te)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[l]},collisionPriority:1,radius:ze,state:C}}function Ne({vertices:e,padding:t,materials:a}){const r=i=>{const n=e.slice(),s=w(d.get(),n[0],n[1]);x(s,s);const o=w(d.get(),n[n.length-1],n[n.length-2]);if(x(o,o),t>0){const W=p(Q(),o,-t);n[n.length-1]=b(W,W,n[n.length-1]);const N=p(Q(),s,-t);n[0]=b(N,N,n[0])}const l=i?Ft:1,u=de*l,c=ze*l,g=Ae(F.get());if(t>0){const W=u/4,N=K(d.get(),0,W,0),z=1+t/W;ve(g,g,N),He(g,g,K(d.get(),z,z,z)),ve(g,g,p(N,N,-1/z))}const h=Ae(ne()),f=P(0,1,0),$=Ee(ne(),Pe(Re.get(),f,o));$[12]=n[n.length-1][0],$[13]=n[n.length-1][1],$[14]=n[n.length-1][2],k($,$,g);const U=a.tube,G=ps(jt*(i?kt:1)+t,n,U);G.transformation=h;const O=[G],re=a.tip,H=Me(re,u,c,24,!1,!1,!0);H.transformation=$,O.push(H);const B=a.cap,ie=Me(B,u,c,24,!1,!0,!1);ie.transformation=$,O.push(ie);const S=Ee(ne(),Pe(Re.get(),f,s));return S[12]=n[0][0],S[13]=n[0][1],S[14]=n[0][2],k(S,S,g),O.push(H.instantiate({transformation:S})),O.push(ie.instantiate({transformation:S})),O};return{normal:r(!1),focused:r(!0)}}function ps(e,t,a){const r=[];for(let n=0;n<12;n++){const s=n/12*2*Math.PI;r.push([Math.cos(s)*e,Math.sin(s)*e])}return Gt(a,r,t,[],[],!1)}function fs(e,t){const a=w(Q(),e[e.length-1],e[e.length-2]);x(a,a),p(a,a,de),b(a,a,e[e.length-1]);{const r=w(Q(),e[0],e[1]);return x(r,r),p(r,r,de),b(r,r,e[0]),[r,...e,a]}}const bs=Object.freeze(Object.defineProperty({__proto__:null,build:qe},Symbol.toStringTag,{value:"Module"}));export{Ls as A,C,me as E,ue as H,ks as I,ys as L,E as M,Ns as R,te as S,ls as U,Vs as V,ee as _,xs as a,Kt as b,Ps as c,Es as d,Cs as e,Jt as f,js as g,le as h,ae as i,Us as j,Rs as l,Gs as m,Ss as p,As as r,vs as s,Zt as t,Ms as u,Ws as v,Hs as x};
