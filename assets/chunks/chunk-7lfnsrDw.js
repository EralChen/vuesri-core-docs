import{p as $,a as O,u as b}from"./chunk-nRJGOpte.js";import{gT as T,np as k,gZ as M,he as S,lB as H,dg as m,hc as L,gU as R,ly as h,lD as j,h8 as _,h0 as B,h9 as U,h6 as v,oE as C,hb as F}from"./chunk-PoaGf_98.js";import{V as W,b as w,a as E,c as q}from"./chunk-TndIPZDn.js";import{u as x}from"./chunk-fdkMBDAT.js";import{_ as A,c as D}from"./chunk-2vvX2e9D.js";function N(){const a=T("vaMediaLayer");if(!a)throw new Error("The component which use useMediaLayer() must be in a MediaLayer component");return a}const P={...$,defaultOptions:{type:Object,default:()=>({})},source:{type:Object,required:!0,default:()=>({})}},g={load:a=>a,click:a=>a,pointerMove:a=>a},Y=k(g),p="__va_media_layer_retries",Z=M({__name:"media-try",setup(a){const c=N(),r=c.source,i=S(),d=[],n=new WeakMap;H(()=>{d.forEach(e=>{e.remove()})}),d.push(c.on("layerview-create",e=>{i.value=e.layerView}));const u=e=>{i.value&&m(()=>!i.value?.updating).then(e)};r instanceof W&&(l(r.elements),r.elements.on("change",()=>{l(r.elements)}));function l(e){e.filter(t=>t.loadStatus!=="loaded").forEach(t=>{if(n.has(t))return;const s=m(()=>t.loadStatus==="failed");n.set(t,s),s.then(()=>{u(()=>{const o=e.find(f=>f===t);if(o&&(o[p]??0)<5){e.remove(o);const f=V(o,{[p]:(o[p]??0)+1,id:o.id});setTimeout(()=>{e.add(f)},1e3)}})})})}function V(e,t={}){let s=e;e instanceof w?s=new w({image:e.image,georeference:e.georeference,animationOptions:e.animationOptions,opacity:e.opacity}):e instanceof E&&(s=new E({video:e.video,georeference:e.georeference,opacity:e.opacity}));for(const o in t)s[o]=t[o];return s}return(e,t)=>L(e.$slots,"default")}}),z=M({name:"VaMediaLayer",components:{VaLayerHitEvents:A,MediaTry:Z},props:P,emits:g,setup(a,{emit:c}){const r=x(),i=r.map,d=D(c),n=new q({...a.defaultOptions});return R(()=>{n.source=a.source}),O(i,n,a),b(n,a),h("vaMediaLayer",n),h("vaLayer",n),c("load",{layer:n,view:r}),{hitEmits:d}}});function G(a,c,r,i,d,n){const u=_("VaLayerHitEvents"),l=_("MediaTry");return B(),U(F,null,[v(u,C(a.hitEmits),null,16),L(a.$slots,"default"),v(l)],64)}const y=j(z,[["render",G]]);y.install=a=>{a.component(y.name||"VaMediaLayer",y)};export{y as V,Y as c,g as e,N as u};
