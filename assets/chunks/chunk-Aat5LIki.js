import{p as $,c as E,h as I}from"./chunk-I0Ze1Lq5.js";import{U as b,a1 as N,gZ as k,lF as T,gV as _,gW as z,hc as S,he as h,ls as P,g_ as M,lu as B,lH as D,h8 as g,h0 as f,h1 as y,h4 as d,hk as v,nv as q,h7 as F,h2 as u,h6 as V}from"./chunk-fHrNL0KE.js";import{V as O}from"./chunk-WwPM8Mdp.js";import{s as Z}from"./chunk-B3AFDltd.js";import{u as A}from"./chunk-oihAJXyJ.js";import"./chunk-DxdXOgnz.js";import"./chunk-aaF08RLl.js";import"./chunk-CJ93w3lF.js";import"./chunk-5sZ8cOm7.js";import"./chunk-qU9ug55b.js";import"./chunk-696gQ_0Y.js";import"./chunk-Gh-YYW1u.js";import"./chunk-dh53Jslg.js";import{V as U}from"./chunk-V7wMI-M1.js";import"./chunk-7WQT7ntw.js";import"./chunk--fAu8HIB.js";import"./chunk-ADeLpH6z.js";import"./chunk-PEmjdORh.js";import{V as Y}from"./chunk-udydY4-Q.js";import"./chunk-lUz6pzTx.js";import"./chunk-OtrhsN3k.js";import"./chunk-hwxJk16m.js";import"./chunk-QxXwI5R8.js";import"./chunk-MdcONs9d.js";import"./chunk-webAJys3.js";import"./chunk-Zdebg6g9.js";import"./chunk-UM8yAOgJ.js";import"./chunk-BZyJvBwR.js";import"./chunk-Or-nAgsa.js";import"./chunk-XfrNqGsj.js";import"./chunk-DhGbJNcI.js";import"./chunk-Nw9qefak.js";import"./chunk-k8skosWR.js";import"./chunk-0R7WeF7L.js";import"./chunk-nIGC-Ax6.js";import"./chunk-F9gjVU-T.js";import"./chunk-oBZYJIeq.js";import"./chunk-PtKCC_GV.js";import"./chunk-oP0o3Nh4.js";import"./chunk-khhwXIoB.js";import"./chunk-2fioQh0W.js";import"./chunk-xKJ-Rb1Q.js";import{V as G,s as H}from"./chunk-CUdjq8cQ.js";import"./chunk-vMCO_d3L.js";import"./chunk-M9hnJ_t7.js";import"./chunk-0wTVHGNT.js";import"./chunk-nMNkS3c7.js";import"./chunk-iirWKWKr.js";import"./chunk-Mv08grWe.js";import"./chunk-QKkDBMz0.js";import"./chunk-FBiO-tOz.js";import"./chunk-H5gP66cR.js";import"./chunk-SQSdfN4Z.js";import"./chunk-UD1v1y82.js";import"./chunk-_hO8gbVC.js";import"./chunk-uJuxWpDx.js";import"./chunk-igw9NDGA.js";import"./chunk-O_wbTWft.js";import"./chunk-YrgFVyC-.js";const x={...$,layerName:{type:String,required:!0},spatialReference:{type:Object,default:()=>({wkid:3857})},url:{type:String,required:!0},token:{type:String,default:""},paint:null,queryable:{type:Boolean,default:!1}},J={load:r=>r,click:r=>r};/* @preserve
* @terraformer/arcgis - v2.1.1 - MIT
* Copyright (c) 2012-2022 Environmental Systems Research Institute, Inc.
* Tue Aug 02 2022 14:23:48 GMT-0700 (Pacific Daylight Time)
*/var K=function(e,o){for(var t=0;t<e.length;t++)if(e[t]!==o[t])return!1;return!0},w=function(e){return K(e[0],e[e.length-1])||e.push(e[0]),e},R=function(e){var o=0,t=0,a=e.length,n=e[t],i;for(t;t<a-1;t++)i=e[t+1],o+=(i[0]-n[0])*(i[1]+n[1]),n=i;return o>=0},W=function(e){var o={};for(var t in e)e.hasOwnProperty(t)&&(o[t]=e[t]);return o},C=function(e){var o=[],t=e.slice(0),a=w(t.shift().slice(0));if(a.length>=4){R(a)||a.reverse(),o.push(a);for(var n=0;n<t.length;n++){var i=w(t[n].slice(0));i.length>=4&&(R(i)&&i.reverse(),o.push(i))}}return o},X=function(e){for(var o=[],t=0;t<e.length;t++)for(var a=C(e[t]),n=a.length-1;n>=0;n--){var i=a[n].slice(0);o.push(i)}return o},Q=function r(e,o){o=o||"OBJECTID";var t={wkid:4326},a={},n;switch(e.type){case"Point":a.x=e.coordinates[0],a.y=e.coordinates[1],e.coordinates[2]!=null&&(a.z=e.coordinates[2]),a.spatialReference=t;break;case"MultiPoint":a.points=e.coordinates.slice(0),e.coordinates[0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"LineString":a.paths=[e.coordinates.slice(0)],e.coordinates[0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"MultiLineString":a.paths=e.coordinates.slice(0),e.coordinates[0][0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"Polygon":a.rings=C(e.coordinates.slice(0)),e.coordinates[0][0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"MultiPolygon":a.rings=X(e.coordinates.slice(0)),e.coordinates[0][0][0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"Feature":e.geometry&&(a.geometry=r(e.geometry,o)),a.attributes=e.properties?W(e.properties):{},e.id&&(a.attributes[o]=e.id);break;case"FeatureCollection":for(a=[],n=0;n<e.features.length;n++)a.push(r(e.features[n],o));break;case"GeometryCollection":for(a=[],n=0;n<e.geometries.length;n++)a.push(r(e.geometries[n],o));break}return a};function j(r,e,o){const t=Q(r,e);return o&&(t.spatialReference=o),t}async function ee(r,e){return b(r,{responseType:"json",query:{LAYER:e.LAYER,token:e.token,SERVICE:"mvt"}}).then(o=>{const t=o.data,a=JSON.parse(t.bbox),n=j(a),i=new N(n);return t.bbox=i,t.fullExtent=i.extent,t})}function te(r,e){return b(r,{responseType:"json",headers:{token:e.token},query:{layerName:e.layerName,point:`${e.longitude},${e.latitude}`}}).then(o=>o)}const re=k({__name:"on-click",props:{token:{type:String,default:""},baseUrl:{type:String,default:""},layerName:{type:String,default:""}},emits:{click:null},setup(r,{emit:e}){const o=r,t=e,n=A()[Z],i=E(n),s=new i("click",async c=>{te(o.baseUrl+"/vector/getVectorInfo",{token:o.token,layerName:o.layerName,latitude:c.event.mapPoint.latitude,longitude:c.event.mapPoint.longitude}).then(l=>{t("click",{...c,requestResponse:l})})});return s.add(),T(()=>{s.remove()}),_(()=>{s.remove()}),z(()=>{s.add()}),(c,l)=>S(c.$slots,"default")}}),ae=k({name:"VaSkzzVectorTileLayer",components:{VaVectorTileLayer:O,OnClick:re},props:x,emits:J,setup(r,{emit:e}){const o=I(r,[]),t=h({}),a=P(()=>{const l={layers:[],version:8,sources:{}};if(t.value.id){l.layers=[{...t.value,paint:r.paint}];const p=t.value.source;p&&(l.sources[p]={type:"vector",tiles:new Array(10).fill(0).map((ne,L)=>`${r.url}/mvt?LAYER=${t.value.id}&SRS=${r.spatialReference.wkid||3857}&SERVICE=mvt&x={x}&y={y}&z={z}&token=${r.token}`.replace("t1",`t${L+1}`))})}return l});M(()=>r.layerName,i,{immediate:!0});const n=h();async function i(){return ee(r.url+"/mvtInfo",{LAYER:r.layerName,token:r.token}).then(l=>{t.value={id:l.id,source:l.source,"source-layer":l["source-layer"],type:l.type},n.value=l})}const s=B(()=>{t.value.id,{...r.paint}});return{layerProps:o,style:a,layerSource:t,ready:s,layerLoad:async l=>{const p=l.layer;n.value&&(p.capabilitiesResponse=n.value),e("load",{view:l.view,layer:p})}}}});function oe(r,e,o,t,a,n){const i=g("OnClick"),s=g("VaVectorTileLayer");return r.ready&&r.layerSource.id?(f(),y(s,{key:0,style:q(r.style),onLoad:r.layerLoad},{default:d(()=>[r.queryable?(f(),y(i,{key:0,"base-url":r.url,token:r.token,"layer-name":r.layerName,onClick:e[0]||(e[0]=c=>r.$emit("click",c))},null,8,["base-url","token","layer-name"])):v("",!0),S(r.$slots,"default")]),_:3},8,["style","onLoad"])):v("",!0)}const m=D(ae,[["render",oe]]);m.install=r=>{r.component(m.name||"VaSkzzVectorTileLayer",m)};const ut=k({__name:"basic",setup(r){const e=F({url:"http://192.168.110.151:33334/zz-mapServer/mapServer/layer",layerName:"V20240605-000003-P3",token:"EAD28020541B4DD1A30C3FE257FB8C369563VEMZVK1YXUJT"}),o=[{templateType:"VkfInput",label:"url",prop:"url"},{templateType:"VkfInput",label:"图层名称",prop:"layerName"},{templateType:"VkfInput",label:"token",prop:"token"}],t={"circle-color":"#ff0000"},a=async i=>{const s=i.view;await s.when(),await i.layer.when();const c=i.layer.capabilitiesResponse.fullExtent;s.goTo(c)},n=async i=>{console.log(i.requestResponse?.data,"e.requestResponse.data")};return(i,s)=>(f(),y(u(Y),null,{before:d(()=>[V(u(G),{"form-items":o,data:e,onSetData:s[0]||(s[0]=c=>u(H)(e,c))},null,8,["data"])]),default:d(()=>[V(u(U),{type:"img_w","spatial-reference":{wkid:3857}}),e.layerName?(f(),y(u(m),{key:0,url:e.url,"layer-name":e.layerName,token:e.token,paint:t,queryable:!0,onLoad:a,onClick:n},null,8,["url","layer-name","token"])):v("",!0)]),_:1}))}});export{ut as default};
