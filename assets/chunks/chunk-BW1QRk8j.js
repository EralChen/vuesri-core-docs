import{a1 as i,a2 as n,a4 as j,fk as P,fl as E,s as V,eM as L,E as S}from"./chunk-CMhy9c9G.js";import{i as _}from"./chunk-DjDIt6nn.js";const $=v=>{let t=class extends v{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.tileInfo=null}get fullExtent(){try{return this.layer.loaded?this._getFullExtent():null}catch{return null}}get timeExtent(){return _(this.layer,this.view?.timeExtent,this._get("timeExtent"))}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){try{return this.layer.loaded?P(this.layer.fullExtent,this.view.spatialReference,!0):null}catch{return null}}supportsSpatialReference(s){try{return!this.layer.loaded||!!E(this.layer.serviceRasterInfo,s)}catch{return!1}}async fetchPopupFeaturesAtLocation(s,f){const{layer:e}=this;if(!s)throw new V("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});const{popupEnabled:w}=e,R=L(e,f);if(!w||R==null)return[];const d=[],{value:l,magdirValue:p,processedValue:T}=await e.identify(s,{timeExtent:this.timeExtent,signal:f?.signal});let u="";if(l?.length){u=e.type==="imagery-tile"&&e.hasStandardTime()&&l[0]!=null?l.map(y=>e.getStandardTimeValue(y)).join(", "):l.join(", ");const r={ObjectId:0},c="Raster.ServicePixelValue";r[c]=e.type==="imagery-tile"&&e.raster.datasetFormat==="Function"?T?.join(", "):u,r[c+".Raw"]=u;const h=e.raster?.rasterInfo??e.serviceRasterInfo,m=h?.attributeTable;if(m!=null){const{fields:y,features:F}=m,x=y.find(({name:a})=>a.toLowerCase()==="value"),I=r[c],o=x?F.find(a=>String(a.attributes[x.name])===I):null;if(o)for(const a in o.attributes)o.attributes.hasOwnProperty(a)&&(r[this._rasterFieldPrefix+a]=o.attributes[a])}const g=h?.dataType;g!=="vector-magdir"&&g!=="vector-uv"||(r["Raster.Magnitude"]=p?.[0],r["Raster.Direction"]=p?.[1]);const b=new S({geometry:this.fullExtent?.clone(),attributes:r,layer:e,sourceLayer:e});d.push(b)}return d}_getFullExtent(){return E(this.layer.serviceRasterInfo,this.view.spatialReference)}};return i([n()],t.prototype,"fullExtent",null),i([n()],t.prototype,"layer",void 0),i([n({readOnly:!0})],t.prototype,"timeExtent",null),i([n()],t.prototype,"tileInfo",void 0),i([n({readOnly:!0})],t.prototype,"hasTilingEffects",null),i([n()],t.prototype,"datumTransformation",null),t=i([j("esri.views.layers.ImageryTileLayerView")],t),t};export{$ as u};
