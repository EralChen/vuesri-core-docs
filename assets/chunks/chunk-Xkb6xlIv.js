import{p as $,c as E,h as I}from"./chunk-DsXvdgDB.js";import{U as b,a3 as N,g$ as k,lJ as T,gY as _,gZ as z,he as S,hg as h,lw as P,h0 as M,ly as B,lL as D,ha as g,h2 as f,h3 as y,h6 as d,hm as v,nG as q,h9 as O,h7 as V,h4 as c}from"./chunk-CGsGeN7j.js";import{V as Z}from"./chunk-85zEa_D-.js";import{s as A}from"./chunk-DHvBO4SR.js";import{u as F}from"./chunk-DgbCwlwU.js";import"./chunk-Dr1sALog.js";import"./chunk-Bml1PvVS.js";import"./chunk-_zdR56FH.js";import"./chunk-CWLsUwCD.js";import"./chunk-CZd7Zndo.js";import"./chunk-DlX-zbf9.js";import"./chunk-DyQGuRCQ.js";import"./chunk-Dy98_7B9.js";import{V as U}from"./chunk-BqaLBfJX.js";import"./chunk-D-0JPQv-.js";import"./chunk-CkzawzMq.js";import"./chunk-C9yBD7Cb.js";import"./chunk-C7XbWWq1.js";import{V as Y}from"./chunk-C7q-KW3o.js";import"./chunk-9zVPGVP4.js";import"./chunk-C_utqa9G.js";import"./chunk-CW_cxDcB.js";import"./chunk-B3snt2sY.js";import"./chunk-CIQxHwnF.js";import"./chunk-DyD8uEb4.js";import"./chunk-DB3wHNNz.js";import"./chunk-DfWzvhe_.js";import"./chunk-DI0FmvNn.js";import"./chunk-DViVixDW.js";import"./chunk-DPKLMxd7.js";import"./chunk-CiCHXmT9.js";import"./chunk-D9DD00pu.js";import"./chunk-DLws_ICa.js";import"./chunk-XjyAEPTQ.js";import"./chunk-quGueftP.js";import"./chunk-ByqNhg-m.js";import"./chunk-CyhEnEbS.js";import"./chunk-4i9HqfK4.js";import"./chunk-gIQ2rMZF.js";import"./chunk-0FpZiehd.js";import"./chunk-DPAEcZdJ.js";import"./chunk-tqA_bKyq.js";import{V as G,s as J}from"./chunk-cIxBT2J0.js";import"./chunk-DDsy5b_a.js";import"./chunk-BENtfmUH.js";import"./chunk-Ch0SDxT-.js";import"./chunk-ByM7454y.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./chunk-Dhm7ozyh.js";import"./chunk-BKL_2IJ-.js";/* empty css              */import"./chunk-CA_Q6Mh5.js";import"./chunk-BkmbGN9h.js";import"./chunk-lDZmKoG3.js";import"./chunk-tOKkYiMS.js";import"./chunk-kMf2kMGt.js";import"./chunk-DEf3pTt_.js";import"./chunk-BgvE4WKF.js";import"./chunk-PfUi-vtr.js";/* empty css              */import"./chunk-CVVVK-cv.js";/* empty css              *//* empty css              */import"./chunk-BS0PZkJ-.js";import"./chunk-PEnVdMt9.js";import"./chunk-BU0sQgI5.js";import"./chunk-_SCJxduo.js";import"./chunk-zKPkODU6.js";const x={...$,layerName:{type:String,required:!0},spatialReference:{type:Object,default:()=>({wkid:3857})},url:{type:String,required:!0},token:{type:String,default:""},paint:null,queryable:{type:Boolean,default:!1}},H={load:r=>r,click:r=>r};/* @preserve
* @terraformer/arcgis - v2.1.1 - MIT
* Copyright (c) 2012-2022 Environmental Systems Research Institute, Inc.
* Tue Aug 02 2022 14:23:48 GMT-0700 (Pacific Daylight Time)
*/var K=function(e,o){for(var t=0;t<e.length;t++)if(e[t]!==o[t])return!1;return!0},w=function(e){return K(e[0],e[e.length-1])||e.push(e[0]),e},R=function(e){var o=0,t=0,a=e.length,i=e[t],n;for(t;t<a-1;t++)n=e[t+1],o+=(n[0]-i[0])*(n[1]+i[1]),i=n;return o>=0},X=function(e){var o={};for(var t in e)e.hasOwnProperty(t)&&(o[t]=e[t]);return o},C=function(e){var o=[],t=e.slice(0),a=w(t.shift().slice(0));if(a.length>=4){R(a)||a.reverse(),o.push(a);for(var i=0;i<t.length;i++){var n=w(t[i].slice(0));n.length>=4&&(R(n)&&n.reverse(),o.push(n))}}return o},Q=function(e){for(var o=[],t=0;t<e.length;t++)for(var a=C(e[t]),i=a.length-1;i>=0;i--){var n=a[i].slice(0);o.push(n)}return o},W=function r(e,o){o=o||"OBJECTID";var t={wkid:4326},a={},i;switch(e.type){case"Point":a.x=e.coordinates[0],a.y=e.coordinates[1],e.coordinates[2]!=null&&(a.z=e.coordinates[2]),a.spatialReference=t;break;case"MultiPoint":a.points=e.coordinates.slice(0),e.coordinates[0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"LineString":a.paths=[e.coordinates.slice(0)],e.coordinates[0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"MultiLineString":a.paths=e.coordinates.slice(0),e.coordinates[0][0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"Polygon":a.rings=C(e.coordinates.slice(0)),e.coordinates[0][0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"MultiPolygon":a.rings=Q(e.coordinates.slice(0)),e.coordinates[0][0][0][2]!=null&&(a.hasZ=!0),a.spatialReference=t;break;case"Feature":e.geometry&&(a.geometry=r(e.geometry,o)),a.attributes=e.properties?X(e.properties):{},e.id&&(a.attributes[o]=e.id);break;case"FeatureCollection":for(a=[],i=0;i<e.features.length;i++)a.push(r(e.features[i],o));break;case"GeometryCollection":for(a=[],i=0;i<e.geometries.length;i++)a.push(r(e.geometries[i],o));break}return a};function j(r,e,o){return W(r,e)}async function ee(r,e){return b(r,{responseType:"json",query:{LAYER:e.LAYER,token:e.token,SERVICE:"mvt"}}).then(o=>{const t=o.data,a=JSON.parse(t.bbox),i=j(a),n=new N(i);return t.bbox=n,t.fullExtent=n.extent,t})}function te(r,e){return b(r,{responseType:"json",headers:{token:e.token},query:{layerName:e.layerName,point:`${e.longitude},${e.latitude}`}}).then(o=>o)}const re=k({__name:"on-click",props:{token:{type:String,default:""},baseUrl:{type:String,default:""},layerName:{type:String,default:""}},emits:{click:null},setup(r,{emit:e}){const o=r,t=e,i=F()[A],n=E(i),s=new n("click",async p=>{te(o.baseUrl+"/vector/getVectorInfo",{token:o.token,layerName:o.layerName,latitude:p.event.mapPoint.latitude,longitude:p.event.mapPoint.longitude}).then(l=>{t("click",{...p,requestResponse:l})})});return s.add(),T(()=>{s.remove()}),_(()=>{s.remove()}),z(()=>{s.add()}),(p,l)=>S(p.$slots,"default")}}),ae=k({name:"VaSkzzVectorTileLayer",components:{VaVectorTileLayer:Z,OnClick:re},props:x,emits:H,setup(r,{emit:e}){const o=I(r,[]),t=h({}),a=P(()=>{const l={layers:[],version:8,sources:{}};if(t.value.id){l.layers=[{...t.value,paint:r.paint}];const m=t.value.source;m&&(l.sources[m]={type:"vector",tiles:new Array(10).fill(0).map((ie,L)=>`${r.url}/mvt?LAYER=${t.value.id}&SRS=${r.spatialReference.wkid||3857}&SERVICE=mvt&x={x}&y={y}&z={z}&token=${r.token}`.replace("t1",`t${L+1}`))})}return l});M(()=>r.layerName,n,{immediate:!0});const i=h();async function n(){return ee(r.url+"/mvtInfo",{LAYER:r.layerName,token:r.token}).then(l=>{t.value={id:l.id,source:l.source,"source-layer":l["source-layer"],type:l.type},i.value=l})}const s=B(()=>{t.value.id,{...r.paint}});return{layerProps:o,style:a,layerSource:t,ready:s,layerLoad:async l=>{const m=l.layer;i.value&&(m.capabilitiesResponse=i.value),e("load",{view:l.view,layer:m})}}}});function oe(r,e,o,t,a,i){const n=g("OnClick"),s=g("VaVectorTileLayer");return r.ready&&r.layerSource.id?(f(),y(s,{key:0,style:q(r.style),onLoad:r.layerLoad},{default:d(()=>[r.queryable?(f(),y(n,{key:0,"base-url":r.url,token:r.token,"layer-name":r.layerName,onClick:e[0]||(e[0]=p=>r.$emit("click",p))},null,8,["base-url","token","layer-name"])):v("",!0),S(r.$slots,"default")]),_:3},8,["style","onLoad"])):v("",!0)}const u=D(ae,[["render",oe]]);u.install=r=>{r.component(u.name||"VaSkzzVectorTileLayer",u)};const Qt=k({__name:"basic",setup(r){const e=O({url:"http://192.168.110.151:33334/zz-mapServer/mapServer/layer",layerName:"V20240605-000003-P3",token:"EAD28020541B4DD1A30C3FE257FB8C369563VEMZVK1YXUJT"}),o=[{templateType:"VkfInput",label:"url",prop:"url"},{templateType:"VkfInput",label:"图层名称",prop:"layerName"},{templateType:"VkfInput",label:"token",prop:"token"}],t={"circle-color":"#ff0000"},a=async n=>{const s=n.view;await s.when(),await n.layer.when();const p=n.layer.capabilitiesResponse.fullExtent;s.goTo(p)},i=async n=>{console.log(n.requestResponse?.data,"e.requestResponse.data")};return(n,s)=>(f(),y(c(Y),null,{before:d(()=>[V(c(G),{"form-items":o,data:e,onSetData:s[0]||(s[0]=p=>c(J)(e,p))},null,8,["data"])]),default:d(()=>[V(c(U),{type:"img_w","spatial-reference":{wkid:3857}}),e.layerName?(f(),y(c(u),{key:0,url:e.url,"layer-name":e.layerName,token:e.token,paint:t,queryable:!0,onLoad:a,onClick:i},null,8,["url","layer-name","token"])):v("",!0)]),_:1}))}});export{Qt as default};
