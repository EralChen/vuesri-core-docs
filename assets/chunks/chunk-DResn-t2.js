import{u as k}from"./chunk-Dc5RCiI0.js";import{u as C}from"./chunk-Bk8Hyb5O.js";import{gO as L,ck as b,lC as g,gL as h,gM as v,lE as M,h1 as O}from"./chunk-CMhy9c9G.js";import{s as S}from"./chunk-DHvBO4SR.js";import{c as T}from"./chunk-35-ZZMVr.js";import{i as I}from"./chunk-_SCJxduo.js";const U={extras:{type:Array,default:()=>[]},createQueryParameters:{type:Function,default:void 0}},w={click:e=>e},A=L({name:"VaWmsLayerOnClick",props:U,emits:w,setup(e,{emit:i}){const t=k(),s=C(),l=t[S],m=T(l),r=new m("click",async u=>{const{event:n}=u,d=s.sublayers.filter(a=>a.visible&&a.queryable&&a.name).map(({name:a})=>a);d.push(...e.extras);const o=d.join(),{xmin:p,ymin:f,xmax:E,ymax:x,spatialReference:{wkid:R}}=t.extent,_=`${p},${f},${E},${x}`,$=`EPSG:${R}`;let y;o&&(y=await b(s.featureInfoUrl,{query:{SERVICE:"WMS",LAYERS:o,QUERY_LAYERS:o,REQUEST:"GetFeatureInfo",INFO_FORMAT:"application/json",FEATURE_COUNT:5,BBOX:_,CRS:$,WIDTH:t.width,HEIGHT:t.height,I:Math.round(n.x),J:Math.round(n.y),...I(e.createQueryParameters)?e.createQueryParameters(n):{}}})),i("click",{...u,requestResponse:y})});return r.add(),g(()=>{r.remove()}),h(()=>{r.remove()}),v(()=>{r.add()}),{}}});function H(e,i,t,s,l,m){return O(e.$slots,"default")}const c=M(A,[["render",H]]);c.install=e=>{e.component(c.name||"VaWmsLayerOnClick",c)};export{c as V};
