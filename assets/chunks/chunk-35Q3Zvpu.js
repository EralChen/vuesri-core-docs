import{p as V,a as O,u as b}from"./chunk-WgvbwtiK.js";import{gS as S,np as T,gY as M,hd as k,lB as H,dg as m,hb as g,gT as R,ly as h,lD as j,h7 as _,g$ as B,h8 as C,h5 as v,oD as D,ha as F}from"./chunk-VRza80L0.js";import{V as U,b as w,a as E,c as W}from"./chunk-1vnZQlal.js";import{u as q}from"./chunk-iptrbIQE.js";import{_ as x,c as A}from"./chunk-EBSwZf5y.js";function N(){const a=S("vaMediaLayer");if(!a)throw new Error("The component which use useMediaLayer() must be in a MediaLayer component");return a}const P={...V,defaultOptions:{type:Object,default:()=>({})},source:{type:Object,required:!0,default:()=>({})}},L={load:a=>a,click:a=>a,pointerMove:a=>a},Z=T(L),p="__va_media_layer_retries",Y=M({__name:"media-try",setup(a){const c=N(),r=c.source,i=k(),d=[],n=new WeakMap;H(()=>{d.forEach(e=>{e.remove()})}),d.push(c.on("layerview-create",e=>{i.value=e.layerView}));const u=e=>{i.value&&m(()=>!i.value?.updating).then(e)};r instanceof U&&(l(r.elements),r.elements.on("change",()=>{l(r.elements)}));function l(e){e.filter(t=>t.loadStatus!=="loaded").forEach(t=>{if(n.has(t))return;const s=m(()=>t.loadStatus==="failed");n.set(t,s),s.then(()=>{u(()=>{const o=e.find(f=>f===t);if(o&&(o[p]??0)<30){e.remove(o);const f=$(o,{[p]:(o[p]??0)+1,id:o.id});setTimeout(()=>{e.add(f)},1e3)}})})})}function $(e,t={}){let s=e;e instanceof w?s=new w({image:e.image,georeference:e.georeference,animationOptions:e.animationOptions,opacity:e.opacity}):e instanceof E&&(s=new E({video:e.video,georeference:e.georeference,opacity:e.opacity}));for(const o in t)s[o]=t[o];return s}return(e,t)=>g(e.$slots,"default")}}),z=M({name:"VaMediaLayer",components:{VaLayerHitEvents:x,MediaTry:Y},props:P,emits:L,setup(a,{emit:c}){const r=q(),i=r.map,d=A(c),n=new W({...a.defaultOptions});return R(()=>{n.source=a.source}),O(i,n,a),b(n,a),h("vaMediaLayer",n),h("vaLayer",n),c("load",{layer:n,view:r}),{hitEmits:d}}});function G(a,c,r,i,d,n){const u=_("VaLayerHitEvents"),l=_("MediaTry");return B(),C(F,null,[v(u,D(a.hitEmits),null,16),g(a.$slots,"default"),v(l)],64)}const y=j(z,[["render",G]]);y.install=a=>{a.component(y.name||"VaMediaLayer",y)};export{y as V,Z as c,L as e,N as u};
